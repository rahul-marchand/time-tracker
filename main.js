"use strict";var $=Object.defineProperty;var R=Object.getOwnPropertyDescriptor;var F=Object.getOwnPropertyNames;var _=Object.prototype.hasOwnProperty;var U=(h,i)=>{for(var t in i)$(h,t,{get:i[t],enumerable:!0})},J=(h,i,t,e)=>{if(i&&typeof i=="object"||typeof i=="function")for(let s of F(i))!_.call(h,s)&&s!==t&&$(h,s,{get:()=>i[s],enumerable:!(e=R(i,s))||e.enumerable});return h};var G=h=>J($({},"__esModule",{value:!0}),h);var q={};U(q,{default:()=>L});module.exports=G(q);var V=require("obsidian");var B={timerState:{status:"idle",projectId:null,startTime:null}},A=[{id:"work",name:"Work",color:"#5f8eed"},{id:"personal",name:"Personal",color:"#50c878"}];var Y="time-data.json",j=class{constructor(i){this.data={projects:[],sessions:[]};this.plugin=i}get path(){return`${this.plugin.manifest.dir}/${Y}`}async load(){let{adapter:i}=this.plugin.app.vault;await i.exists(this.path)?this.data=JSON.parse(await i.read(this.path)):(this.data={projects:[...A],sessions:[]},await this.save())}async save(){await this.plugin.app.vault.adapter.write(this.path,JSON.stringify(this.data,null,"	"))}get projects(){return this.data.projects}getProject(i){return this.data.projects.find(t=>t.id===i)}async addProject(i){this.data.projects.push(i),await this.save()}async updateProject(i,t){let e=this.getProject(i);e&&(Object.assign(e,t),await this.save())}async deleteProject(i){this.data.projects=this.data.projects.filter(t=>t.id!==i),this.data.sessions=this.data.sessions.filter(t=>t.project!==i),await this.save()}get sessions(){return this.data.sessions}async addSession(i){this.data.sessions.push(i),await this.save()}async updateSession(i,t){i>=0&&i<this.data.sessions.length&&(this.data.sessions[i]=t,await this.save())}async deleteSession(i){i>=0&&i<this.data.sessions.length&&(this.data.sessions.splice(i,1),await this.save())}getSessionsInRange(i,t){return this.data.sessions.filter(e=>{let s=new Date(e.start).getTime();return s>=i.getTime()&&s<t.getTime()})}getTotalTime(i){return i.reduce((t,e)=>t+new Date(e.end).getTime()-new Date(e.start).getTime(),0)}getTodaySessions(){let i=new Date;i.setHours(0,0,0,0);let t=new Date(i);return t.setDate(t.getDate()+1),this.getSessionsInRange(i,t)}getWeekSessions(){let i=new Date,t=new Date(i);t.setDate(i.getDate()-i.getDay()),t.setHours(0,0,0,0);let e=new Date(t);return e.setDate(e.getDate()+7),this.getSessionsInRange(t,e)}};var H=require("obsidian"),k=class extends H.Events{constructor(t,e){super();this.state={status:"idle",projectId:null,startTime:null};this.store=t,this.persistState=e}load(t){this.state=t}get status(){return this.state.status}get projectId(){return this.state.projectId}get startTime(){return this.state.startTime?new Date(this.state.startTime):null}get elapsed(){return this.state.status==="idle"||!this.state.startTime?0:Date.now()-new Date(this.state.startTime).getTime()}async start(t){this.state.status==="running"&&await this.stop(),this.state={status:"running",projectId:t,startTime:new Date().toISOString()},await this.persistState(this.state),this.trigger("change")}async stop(){if(this.state.status==="idle"||!this.state.projectId||!this.state.startTime)return null;let t={project:this.state.projectId,start:this.state.startTime,end:new Date().toISOString()};return await this.store.addSession(t),this.state={status:"idle",projectId:null,startTime:null},await this.persistState(this.state),this.trigger("change"),t}async discard(){this.state={status:"idle",projectId:null,startTime:null},await this.persistState(this.state),this.trigger("change")}async addManual(t,e,s){await this.store.addSession({project:t,start:e.toISOString(),end:s.toISOString()}),this.trigger("change")}};var P=class{constructor(i,t,e){this.interval=null;this.timer=t,this.store=e,this.el=i.addStatusBarItem(),this.el.addClass("time-tracker-status"),this.el.onClickEvent(()=>this.onClick()),this.timer.on("change",()=>this.render()),this.render(),this.startInterval()}startInterval(){this.interval=window.setInterval(()=>{this.timer.status==="running"&&this.render()},1e3)}destroy(){this.interval&&window.clearInterval(this.interval)}render(){var e;let{status:i,projectId:t}=this.timer;if(i==="idle")this.el.setText("\u23F1 No timer"),this.el.removeClass("is-running");else{let s=this.store.getProject(t),a=(e=s==null?void 0:s.name)!=null?e:t,r=this.formatTime(this.timer.elapsed);this.el.setText(`\u23F1 ${a} ${r}`),this.el.addClass("is-running")}}formatTime(i){let t=Math.floor(i/1e3),e=Math.floor(t/3600),s=Math.floor(t%3600/60),a=t%60;return`${e.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`}onClick(){this.timer.trigger("status-bar-click")}};var W=require("obsidian"),E=class extends W.Modal{constructor(t,e){super(t);this.store=e}onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("time-tracker-stats-modal"),t.createEl("h2",{text:"Time Stats"}),this.renderSection(t,"Today",this.store.getTodaySessions()),this.renderSection(t,"This Week",this.store.getWeekSessions())}renderSection(t,e,s){var l,p;let a=t.createDiv("stats-section");a.createEl("h3",{text:e});let r=this.groupByProject(s),o=this.store.getTotalTime(s);if(Object.keys(r).length===0){a.createEl("p",{text:"No time tracked",cls:"muted"});return}let d=a.createEl("ul",{cls:"stats-list"});for(let[m,u]of Object.entries(r)){let n=this.store.getProject(m),g=this.store.getTotalTime(u),c=d.createEl("li"),y=c.createSpan({cls:"color-dot"});y.style.backgroundColor=(l=n==null?void 0:n.color)!=null?l:"#888",c.createSpan({text:`${(p=n==null?void 0:n.name)!=null?p:m}: ${this.formatTime(g)}`})}a.createEl("p",{text:`Total: ${this.formatTime(o)}`,cls:"stats-total"})}groupByProject(t){var s,a;let e={};for(let r of t)((a=e[s=r.project])!=null?a:e[s]=[]).push(r);return e}formatTime(t){let e=Math.round(t/6e4),s=Math.floor(e/60),a=e%60;return s>0?`${s}h ${a}m`:`${a}m`}onClose(){this.contentEl.empty()}};var v=require("obsidian"),x=class extends v.Modal{constructor(t,e,s){var r,o;super(t);this.timer=e,this.store=s;let a=new Date;this.projectId=(o=(r=this.store.projects[0])==null?void 0:r.id)!=null?o:"",this.date=a.toISOString().split("T")[0],this.startTime="09:00",this.endTime="10:00"}onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("time-tracker-manual-modal"),t.createEl("h3",{text:"Add Time Manually"}),new v.Setting(t).setName("Project").addDropdown(e=>{for(let s of this.store.projects)e.addOption(s.id,s.name);e.setValue(this.projectId),e.onChange(s=>this.projectId=s)}),new v.Setting(t).setName("Date").addText(e=>{e.inputEl.type="date",e.setValue(this.date),e.onChange(s=>this.date=s)}),new v.Setting(t).setName("Start Time").addText(e=>{e.inputEl.type="time",e.setValue(this.startTime),e.onChange(s=>this.startTime=s)}),new v.Setting(t).setName("End Time").addText(e=>{e.inputEl.type="time",e.setValue(this.endTime),e.onChange(s=>this.endTime=s)}),new v.Setting(t).addButton(e=>{e.setButtonText("Add"),e.setCta(),e.onClick(()=>this.submit())})}async submit(){let t=new Date(`${this.date}T${this.startTime}`),e=new Date(`${this.date}T${this.endTime}`);e<=t||(await this.timer.addManual(this.projectId,t,e),this.close())}onClose(){this.contentEl.empty()}};var D=require("obsidian"),C=class extends D.PluginSettingTab{constructor(t,e){super(t,e);this.plugin=e}display(){let{containerEl:t}=this;t.empty(),t.createEl("h2",{text:"Projects"});for(let e of this.plugin.store.projects)this.renderProject(t,e);new D.Setting(t).addButton(e=>{e.setButtonText("Add Project"),e.setCta(),e.onClick(async()=>{let s=`project-${Date.now()}`;await this.plugin.store.addProject({id:s,name:"New Project",color:this.randomColor()}),this.display()})})}renderProject(t,e){let s=new D.Setting(t);s.setName(e.name);let a=s.nameEl.createSpan({cls:"color-dot"});a.style.backgroundColor=e.color,s.nameEl.prepend(a),s.addText(r=>{r.setValue(e.name),r.onChange(async o=>{await this.plugin.store.updateProject(e.id,{name:o}),s.setName(o)})}),s.addText(r=>{r.inputEl.type="color",r.inputEl.addClass("color-input"),r.setValue(e.color),r.onChange(async o=>{await this.plugin.store.updateProject(e.id,{color:o}),a.style.backgroundColor=o})}),this.plugin.store.projects.length>1&&s.addButton(r=>{r.setIcon("trash"),r.setWarning(),r.onClick(async()=>{await this.plugin.store.deleteProject(e.id),this.display()})})}randomColor(){return`hsl(${Math.floor(Math.random()*360)}, 60%, 50%)`}};var I=require("obsidian"),S="time-tracker-sidebar",M=class extends I.ItemView{constructor(t,e,s){super(t);this.interval=null;this.activeTab="timer";this.timer=e,this.store=s}getViewType(){return S}getDisplayText(){return"Time Tracker"}getIcon(){return"clock"}async onOpen(){this.timer.on("change",()=>this.render()),this.startInterval(),this.render()}async onClose(){this.interval&&window.clearInterval(this.interval)}startInterval(){this.interval=window.setInterval(()=>{this.timer.status==="running"&&this.render()},1e3)}render(){let t=this.containerEl.children[1];t.empty(),t.addClass("time-tracker-sidebar"),this.renderTabs(t),this.activeTab==="timer"?this.renderTimerView(t):this.renderAnalyticsView(t)}renderTabs(t){let e=t.createDiv("sidebar-tabs"),s=e.createDiv("sidebar-tab");s.setText("Timer"),this.activeTab==="timer"&&s.addClass("active"),s.onClickEvent(()=>{this.activeTab="timer",this.render()});let a=e.createDiv("sidebar-tab");a.setText("Analytics"),this.activeTab==="analytics"&&a.addClass("active"),a.onClickEvent(()=>{this.activeTab="analytics",this.render()})}renderTimerView(t){let e=t.createDiv("timer-view");this.renderTimer(e),this.renderToday(e)}renderTimer(t){var s,a;let e=t.createDiv("timer-section");if(this.timer.status==="idle"){let r=e.createDiv("project-buttons");for(let o of this.store.projects){let d=r.createEl("button",{cls:"project-btn"});d.style.setProperty("--project-color",o.color);let l=d.createDiv("project-btn-icon");l.style.backgroundColor=o.color,l.setText("\u25B6"),d.createSpan("project-btn-name").setText(o.name),d.onClickEvent(()=>this.timer.start(o.id))}}else{let r=this.store.getProject(this.timer.projectId);e.addClass("running"),e.style.setProperty("--active-color",(s=r==null?void 0:r.color)!=null?s:"#888");let o=e.createDiv("timer-active-header");o.createSpan("timer-active-label").setText("Tracking"),o.createSpan("timer-active-project").setText((a=r==null?void 0:r.name)!=null?a:"Unknown"),e.createDiv("timer-display").setText(this.formatTime(this.timer.elapsed));let l=e.createDiv("timer-actions"),p=l.createEl("button",{cls:"timer-btn stop"});p.createSpan("timer-btn-icon").setText("\u25A0"),p.createSpan().setText("Stop"),p.onClickEvent(()=>this.timer.stop());let m=l.createEl("button",{cls:"timer-btn switch"});m.createSpan("timer-btn-icon").setText("\u21BB"),m.createSpan().setText("Switch"),m.onClickEvent(u=>this.showSwitchMenu(m,u))}}renderToday(t){var n,g;let e=t.createDiv("today-section"),s=this.store.getTodaySessions(),a=this.store.getTotalTime(s),r=this.timer.status==="running"?this.timer.elapsed:0,o=a+r,d=e.createDiv("today-header");d.createSpan("today-label").setText("Today"),d.createSpan("today-total").setText(this.formatTimeHM(o));let l=8*60*60*1e3,p=Math.min(o/l,1),u=e.createDiv("today-progress").createDiv("today-progress-fill");if(u.style.width=`${p*100}%`,this.timer.status==="idle"){let c=e.createDiv("today-breakdown");if(s.length===0)c.createDiv("today-empty").setText("No sessions yet today");else{let y=this.groupByProject(s);for(let[w,b]of Object.entries(y)){let T=this.store.getProject(w),O=this.store.getTotalTime(b),f=c.createDiv("today-row"),N=f.createSpan("today-dot");N.style.backgroundColor=(n=T==null?void 0:T.color)!=null?n:"#888",f.createSpan("today-name").setText((g=T==null?void 0:T.name)!=null?g:w),f.createSpan("today-time").setText(this.formatTimeHM(O))}}}}renderAnalyticsView(t){let e=t.createDiv("analytics-view");this.renderWeekChart(e),this.renderProjectBreakdown(e)}renderWeekChart(t){let e=t.createDiv("analytics-section"),s=this.store.getWeekSessions(),a=this.store.getTotalTime(s),r=e.createDiv("analytics-header");r.createSpan("analytics-label").setText("This Week"),r.createSpan("analytics-total").setText(this.formatTimeHM(a));let o=this.getDailyTotals(),d=Math.max(...o.map(m=>m.total),1),l=e.createDiv("week-chart"),p=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];o.forEach((m,u)=>{let n=l.createDiv("week-bar"),g=m.total/d*100,c=n.createDiv("week-bar-fill");c.style.height=`${Math.max(g,2)}%`,m.isToday&&c.addClass("today"),n.createDiv("week-bar-label").setText(p[u])})}renderProjectBreakdown(t){var p,m,u;let e=t.createDiv("analytics-section");e.createDiv("analytics-header").createSpan("analytics-label").setText("By Project");let a=this.store.getWeekSessions(),r=this.store.getTotalTime(a);if(a.length===0){e.createDiv("analytics-empty").setText("No data this week");return}let o=this.groupByProject(a),d=e.createDiv("project-breakdown"),l=Object.entries(o).map(([n,g])=>({id:n,time:this.store.getTotalTime(g)})).sort((n,g)=>g.time-n.time);for(let{id:n,time:g}of l){let c=this.store.getProject(n),y=r>0?g/r*100:0,w=d.createDiv("breakdown-row"),b=w.createDiv("breakdown-info"),T=b.createSpan("breakdown-dot");T.style.backgroundColor=(p=c==null?void 0:c.color)!=null?p:"#888",b.createSpan("breakdown-name").setText((m=c==null?void 0:c.name)!=null?m:n),b.createSpan("breakdown-time").setText(this.formatTimeHM(g));let f=w.createDiv("breakdown-bar").createDiv("breakdown-bar-fill");f.style.width=`${y}%`,f.style.backgroundColor=(u=c==null?void 0:c.color)!=null?u:"#888"}}getDailyTotals(){let t=new Date,e=(t.getDay()+6)%7,s=[];for(let a=0;a<7;a++){let r=new Date(t);r.setDate(t.getDate()-e+a),r.setHours(0,0,0,0);let o=new Date(r);o.setDate(r.getDate()+1);let d=this.store.getSessionsInRange(r,o),l=this.store.getTotalTime(d);s.push({total:l,isToday:a===e})}return s}showSwitchMenu(t,e){let s=new I.Menu;for(let a of this.store.projects)a.id!==this.timer.projectId&&s.addItem(r=>{r.setTitle(a.name),r.onClick(()=>this.timer.start(a.id))});s.showAtMouseEvent(e)}groupByProject(t){var s,a;let e={};for(let r of t)((a=e[s=r.project])!=null?a:e[s]=[]).push(r);return e}formatTime(t){let e=Math.floor(t/1e3),s=Math.floor(e/3600),a=Math.floor(e%3600/60),r=e%60;return`${s.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}`}formatTimeHM(t){let e=Math.round(t/6e4),s=Math.floor(e/60),a=e%60;return s>0?`${s}h ${a}m`:`${a}m`}};var L=class extends V.Plugin{async onload(){await this.loadSettings(),this.store=new j(this),await this.store.load(),this.timer=new k(this.store,t=>this.saveTimerState(t)),this.timer.load(this.settings.timerState),this.registerView(S,t=>new M(t,this.timer,this.store)),this.statusBar=new P(this,this.timer,this.store),this.timer.on("status-bar-click",()=>this.activateSidebar()),this.addCommand({id:"open-tracker",name:"Open Time Tracker",callback:()=>this.activateSidebar()}),this.addCommand({id:"start-stop",name:"Start/Stop Timer",callback:()=>{this.timer.status==="running"?this.timer.stop():this.activateSidebar()}}),this.addCommand({id:"show-stats",name:"Show Stats",callback:()=>new E(this.app,this.store).open()}),this.addCommand({id:"add-manual",name:"Add Time Manually",callback:()=>new x(this.app,this.timer,this.store).open()}),this.addSettingTab(new C(this.app,this)),this.app.workspace.onLayoutReady(()=>this.initSidebar())}onunload(){var t;(t=this.statusBar)==null||t.destroy(),this.app.workspace.detachLeavesOfType(S)}async activateSidebar(){let{workspace:t}=this.app,e=t.getLeavesOfType(S)[0];if(!e){let s=t.getRightLeaf(!1);s&&(e=s,await e.setViewState({type:S,active:!0}))}e&&t.revealLeaf(e)}async initSidebar(){this.app.workspace.getLeavesOfType(S).length===0&&await this.activateSidebar()}async loadSettings(){this.settings=Object.assign({},B,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}async saveTimerState(t){this.settings.timerState=t,await this.saveSettings()}};
