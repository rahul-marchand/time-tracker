"use strict";var L=Object.defineProperty;var U=Object.getOwnPropertyDescriptor;var J=Object.getOwnPropertyNames;var G=Object.prototype.hasOwnProperty;var Y=(n,i)=>{for(var t in i)L(n,t,{get:i[t],enumerable:!0})},q=(n,i,t,e)=>{if(i&&typeof i=="object"||typeof i=="function")for(let s of J(i))!G.call(n,s)&&s!==t&&L(n,s,{get:()=>i[s],enumerable:!(e=U(i,s))||e.enumerable});return n};var z=n=>q(L({},"__esModule",{value:!0}),n);var Q={};Y(Q,{default:()=>M});module.exports=z(Q);var V=require("obsidian");var A={timerState:{status:"idle",projectId:null,startTime:null}},H=[{id:"work",name:"Work",color:"#5f8eed"},{id:"personal",name:"Personal",color:"#50c878"}];var K="time-data.json",P=class{constructor(i){this.data={projects:[],sessions:[]};this.plugin=i}get path(){return`${this.plugin.manifest.dir}/${K}`}async load(){let{adapter:i}=this.plugin.app.vault;await i.exists(this.path)?this.data=JSON.parse(await i.read(this.path)):(this.data={projects:[...H],sessions:[]},await this.save())}async save(){await this.plugin.app.vault.adapter.write(this.path,JSON.stringify(this.data,null,"	"))}get projects(){return this.data.projects}getProject(i){return this.data.projects.find(t=>t.id===i)}async addProject(i){this.data.projects.push(i),await this.save()}async updateProject(i,t){let e=this.getProject(i);e&&(Object.assign(e,t),await this.save())}async deleteProject(i){this.data.projects=this.data.projects.filter(t=>t.id!==i),this.data.sessions=this.data.sessions.filter(t=>t.project!==i),await this.save()}get sessions(){return this.data.sessions}async addSession(i){this.data.sessions.push(i),await this.save()}async updateSession(i,t){i>=0&&i<this.data.sessions.length&&(this.data.sessions[i]=t,await this.save())}async deleteSession(i){i>=0&&i<this.data.sessions.length&&(this.data.sessions.splice(i,1),await this.save())}getSessionsInRange(i,t){return this.data.sessions.filter(e=>{let s=new Date(e.start).getTime();return s>=i.getTime()&&s<t.getTime()})}getTotalTime(i){return i.reduce((t,e)=>t+new Date(e.end).getTime()-new Date(e.start).getTime(),0)}getTodaySessions(){let i=new Date;i.setHours(0,0,0,0);let t=new Date(i);return t.setDate(t.getDate()+1),this.getSessionsInRange(i,t)}getWeekSessions(){let i=new Date,t=new Date(i);t.setDate(i.getDate()-i.getDay()),t.setHours(0,0,0,0);let e=new Date(t);return e.setDate(e.getDate()+7),this.getSessionsInRange(t,e)}};var N=require("obsidian"),D=class extends N.Events{constructor(t,e){super();this.state={status:"idle",projectId:null,startTime:null};this.store=t,this.persistState=e}load(t){this.state=t}get status(){return this.state.status}get projectId(){return this.state.projectId}get startTime(){return this.state.startTime?new Date(this.state.startTime):null}get elapsed(){return this.state.status==="idle"||!this.state.startTime?0:Date.now()-new Date(this.state.startTime).getTime()}async start(t){this.state.status==="running"&&await this.stop(),this.state={status:"running",projectId:t,startTime:new Date().toISOString()},await this.persistState(this.state),this.trigger("change")}async stop(){if(this.state.status==="idle"||!this.state.projectId||!this.state.startTime)return null;let t={project:this.state.projectId,start:this.state.startTime,end:new Date().toISOString()};return await this.store.addSession(t),this.state={status:"idle",projectId:null,startTime:null},await this.persistState(this.state),this.trigger("change"),t}async discard(){this.state={status:"idle",projectId:null,startTime:null},await this.persistState(this.state),this.trigger("change")}async addManual(t,e,s){await this.store.addSession({project:t,start:e.toISOString(),end:s.toISOString()}),this.trigger("change")}};var k=class{constructor(i,t,e){this.interval=null;this.timer=t,this.store=e,this.el=i.addStatusBarItem(),this.el.addClass("time-tracker-status"),this.el.onClickEvent(()=>this.onClick()),this.timer.on("change",()=>this.render()),this.render(),this.startInterval()}startInterval(){this.interval=window.setInterval(()=>{this.timer.status==="running"&&this.render()},1e3)}destroy(){this.interval&&window.clearInterval(this.interval)}render(){var e;let{status:i,projectId:t}=this.timer;if(i==="idle")this.el.setText("\u23F1 Start timer"),this.el.removeClass("is-running");else{let s=this.store.getProject(t),a=(e=s==null?void 0:s.name)!=null?e:t,r=this.formatTime(this.timer.elapsed);this.el.setText(`\u23F1 ${a} ${r}`),this.el.addClass("is-running")}}formatTime(i){let t=Math.floor(i/1e3),e=Math.floor(t/3600),s=Math.floor(t%3600/60),a=t%60;return`${e.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`}onClick(){this.timer.trigger("status-bar-click")}};var R=require("obsidian"),E=class extends R.Modal{constructor(t,e){super(t);this.store=e}onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("time-tracker-stats-modal"),t.createEl("h2",{text:"Time Stats"}),this.renderSection(t,"Today",this.store.getTodaySessions()),this.renderSection(t,"This Week",this.store.getWeekSessions())}renderSection(t,e,s){var m,h;let a=t.createDiv("stats-section");a.createEl("h3",{text:e});let r=this.groupByProject(s),o=this.store.getTotalTime(s);if(Object.keys(r).length===0){a.createEl("p",{text:"No time tracked",cls:"muted"});return}let c=a.createEl("ul",{cls:"stats-list"});for(let[w,T]of Object.entries(r)){let d=this.store.getProject(w),y=this.store.getTotalTime(T),S=c.createEl("li"),j=S.createSpan({cls:"color-dot"});j.style.backgroundColor=(m=d==null?void 0:d.color)!=null?m:"#888",S.createSpan({text:`${(h=d==null?void 0:d.name)!=null?h:w}: ${this.formatTime(y)}`})}a.createEl("p",{text:`Total: ${this.formatTime(o)}`,cls:"stats-total"})}groupByProject(t){var s,a;let e={};for(let r of t)((a=e[s=r.project])!=null?a:e[s]=[]).push(r);return e}formatTime(t){let e=Math.round(t/6e4),s=Math.floor(e/60),a=e%60;return s>0?`${s}h ${a}m`:`${a}m`}onClose(){this.contentEl.empty()}};var u=require("obsidian"),I=class extends u.Modal{constructor(t,e,s){var r,o;super(t);this.timer=e,this.store=s;let a=new Date;this.projectId=(o=(r=this.store.projects[0])==null?void 0:r.id)!=null?o:"",this.date=a.toISOString().split("T")[0],this.startTime="09:00",this.endTime="10:00"}onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("time-tracker-manual-modal"),t.createEl("h3",{text:"Add Time Manually"}),new u.Setting(t).setName("Project").addDropdown(e=>{for(let s of this.store.projects)e.addOption(s.id,s.name);e.setValue(this.projectId),e.onChange(s=>this.projectId=s)}),new u.Setting(t).setName("Date").addText(e=>{e.inputEl.type="date",e.setValue(this.date),e.onChange(s=>this.date=s)}),new u.Setting(t).setName("Start Time").addText(e=>{e.inputEl.type="time",e.setValue(this.startTime),e.onChange(s=>this.startTime=s)}),new u.Setting(t).setName("End Time").addText(e=>{e.inputEl.type="time",e.setValue(this.endTime),e.onChange(s=>this.endTime=s)}),new u.Setting(t).addButton(e=>{e.setButtonText("Add"),e.setCta(),e.onClick(()=>this.submit())})}async submit(){let t=new Date(`${this.date}T${this.startTime}`),e=new Date(`${this.date}T${this.endTime}`);e<=t||(await this.timer.addManual(this.projectId,t,e),this.close())}onClose(){this.contentEl.empty()}};var f=require("obsidian"),C=class extends f.PluginSettingTab{constructor(t,e){super(t,e);this.plugin=e}display(){let{containerEl:t}=this;t.empty(),t.createEl("h2",{text:"Projects"});for(let e of this.plugin.store.projects)this.renderProject(t,e);new f.Setting(t).addButton(e=>{e.setButtonText("Add Project"),e.setCta(),e.onClick(async()=>{let s=`project-${Date.now()}`;await this.plugin.store.addProject({id:s,name:"New Project",color:this.randomColor()}),this.display()})})}renderProject(t,e){let s=new f.Setting(t);s.setName(e.name);let a=s.nameEl.createSpan({cls:"color-dot"});a.style.backgroundColor=e.color,s.nameEl.prepend(a),s.addText(r=>{r.setValue(e.name),r.onChange(async o=>{await this.plugin.store.updateProject(e.id,{name:o}),s.setName(o)})}),s.addText(r=>{r.inputEl.type="color",r.inputEl.addClass("color-input"),r.setValue(e.color),r.onChange(async o=>{await this.plugin.store.updateProject(e.id,{color:o}),a.style.backgroundColor=o})}),this.plugin.store.projects.length>1&&s.addButton(r=>{r.setIcon("trash"),r.setWarning(),r.onClick(async()=>{await this.plugin.store.deleteProject(e.id),this.display()})})}randomColor(){return`hsl(${Math.floor(Math.random()*360)}, 60%, 50%)`}};var x=require("obsidian"),g="time-tracker-sidebar",b=class extends x.ItemView{constructor(t,e,s){super(t);this.interval=null;this.timer=e,this.store=s}getViewType(){return g}getDisplayText(){return"Time Tracker"}getIcon(){return"clock"}async onOpen(){this.timer.on("change",()=>this.render()),this.startInterval(),this.render()}async onClose(){this.interval&&window.clearInterval(this.interval)}startInterval(){this.interval=window.setInterval(()=>{this.timer.status==="running"&&this.render()},1e3)}render(){let t=this.containerEl.children[1];t.empty(),t.addClass("time-tracker-sidebar"),this.renderTimer(t),this.renderToday(t)}renderTimer(t){var s,a;let e=t.createDiv("timer-section");if(this.timer.status==="idle"){e.createDiv("timer-idle-text").setText("No timer running");let r=e.createDiv("timer-project-list");for(let o of this.store.projects){let c=r.createEl("button",{cls:"timer-start-btn"}),m=c.createSpan("color-dot");m.style.backgroundColor=o.color,c.createSpan().setText(o.name),c.onClickEvent(()=>this.timer.start(o.id))}}else{let r=this.store.getProject(this.timer.projectId),o=e.createDiv("timer-header"),c=o.createSpan("color-dot large");c.style.backgroundColor=(s=r==null?void 0:r.color)!=null?s:"#888",o.createSpan("timer-project-name").setText((a=r==null?void 0:r.name)!=null?a:"Unknown");let m=e.createDiv("timer-display");m.setText(this.formatTime(this.timer.elapsed)),m.addClass("running");let h=e.createDiv("timer-actions");h.createEl("button",{text:"Stop",cls:"mod-warning"}).onClickEvent(()=>this.timer.stop());let T=h.createEl("button",{text:"Switch"});T.onClickEvent(d=>this.showSwitchMenu(T,d))}}renderToday(t){var y,S,j,O;let e=t.createDiv("today-section");e.createEl("h3",{text:"Today"});let s=this.store.getTodaySessions(),a=this.store.getTotalTime(s),r=this.timer.status==="running"?this.timer.elapsed:0,o=a+r,c=8*60*60*1e3,m=Math.min(o/c,1),h=e.createDiv("progress-container"),T=h.createDiv("progress-bar").createDiv("progress-fill");if(T.style.width=`${m*100}%`,h.createDiv("progress-text").setText(this.formatTimeHM(o)),s.length===0&&this.timer.status==="idle")e.createDiv("no-sessions").setText("No sessions yet");else{let B=e.createDiv("timeline"),W=this.groupByProject(s);for(let[l,v]of Object.entries(W)){let p=this.store.getProject(l),_=this.store.getTotalTime(v),$=B.createDiv("timeline-row"),F=$.createSpan("color-dot");F.style.backgroundColor=(y=p==null?void 0:p.color)!=null?y:"#888",$.createSpan("timeline-name").setText((S=p==null?void 0:p.name)!=null?S:l),$.createSpan("timeline-time").setText(this.formatTimeHM(_))}if(this.timer.status==="running"){let l=this.store.getProject(this.timer.projectId),v=B.createDiv("timeline-row current"),p=v.createSpan("color-dot pulse");p.style.backgroundColor=(j=l==null?void 0:l.color)!=null?j:"#888",v.createSpan("timeline-name").setText((O=l==null?void 0:l.name)!=null?O:"Unknown"),v.createSpan("timeline-time").setText(this.formatTimeHM(this.timer.elapsed))}}}showSwitchMenu(t,e){let s=new x.Menu;for(let a of this.store.projects)a.id!==this.timer.projectId&&s.addItem(r=>{r.setTitle(a.name),r.onClick(()=>this.timer.start(a.id))});s.showAtMouseEvent(e)}groupByProject(t){var s,a;let e={};for(let r of t)((a=e[s=r.project])!=null?a:e[s]=[]).push(r);return e}formatTime(t){let e=Math.floor(t/1e3),s=Math.floor(e/3600),a=Math.floor(e%3600/60),r=e%60;return`${s.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}`}formatTimeHM(t){let e=Math.round(t/6e4),s=Math.floor(e/60),a=e%60;return s>0?`${s}h ${a}m`:`${a}m`}};var M=class extends V.Plugin{async onload(){await this.loadSettings(),this.store=new P(this),await this.store.load(),this.timer=new D(this.store,t=>this.saveTimerState(t)),this.timer.load(this.settings.timerState),this.registerView(g,t=>new b(t,this.timer,this.store)),this.statusBar=new k(this,this.timer,this.store),this.timer.on("status-bar-click",()=>this.activateSidebar()),this.addCommand({id:"open-tracker",name:"Open Time Tracker",callback:()=>this.activateSidebar()}),this.addCommand({id:"start-stop",name:"Start/Stop Timer",callback:()=>{this.timer.status==="running"?this.timer.stop():this.activateSidebar()}}),this.addCommand({id:"show-stats",name:"Show Stats",callback:()=>new E(this.app,this.store).open()}),this.addCommand({id:"add-manual",name:"Add Time Manually",callback:()=>new I(this.app,this.timer,this.store).open()}),this.addSettingTab(new C(this.app,this)),this.app.workspace.onLayoutReady(()=>this.initSidebar())}onunload(){var t;(t=this.statusBar)==null||t.destroy(),this.app.workspace.detachLeavesOfType(g)}async activateSidebar(){let{workspace:t}=this.app,e=t.getLeavesOfType(g)[0];if(!e){let s=t.getRightLeaf(!1);s&&(e=s,await e.setViewState({type:g,active:!0}))}e&&t.revealLeaf(e)}async initSidebar(){this.app.workspace.getLeavesOfType(g).length===0&&await this.activateSidebar()}async loadSettings(){this.settings=Object.assign({},A,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}async saveTimerState(t){this.settings.timerState=t,await this.saveSettings()}};
