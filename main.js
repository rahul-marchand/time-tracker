"use strict";var y=Object.defineProperty;var O=Object.getOwnPropertyDescriptor;var B=Object.getOwnPropertyNames;var N=Object.prototype.hasOwnProperty;var L=(o,s)=>{for(var t in s)y(o,t,{get:s[t],enumerable:!0})},R=(o,s,t,e)=>{if(s&&typeof s=="object"||typeof s=="function")for(let i of B(s))!N.call(o,i)&&i!==t&&y(o,i,{get:()=>s[i],enumerable:!(e=O(s,i))||e.enumerable});return o};var H=o=>R(y({},"__esModule",{value:!0}),o);var F={};L(F,{default:()=>w});module.exports=H(F);var b=require("obsidian");var D={timerState:{status:"idle",projectId:null,startTime:null}},C=[{id:"work",name:"Work",color:"#5f8eed"},{id:"personal",name:"Personal",color:"#50c878"}];var V="time-data.json",g=class{constructor(s){this.data={projects:[],sessions:[]};this.plugin=s}get path(){return`${this.plugin.manifest.dir}/${V}`}async load(){let{adapter:s}=this.plugin.app.vault;await s.exists(this.path)?this.data=JSON.parse(await s.read(this.path)):(this.data={projects:[...C],sessions:[]},await this.save())}async save(){await this.plugin.app.vault.adapter.write(this.path,JSON.stringify(this.data,null,"	"))}get projects(){return this.data.projects}getProject(s){return this.data.projects.find(t=>t.id===s)}async addProject(s){this.data.projects.push(s),await this.save()}async updateProject(s,t){let e=this.getProject(s);e&&(Object.assign(e,t),await this.save())}async deleteProject(s){this.data.projects=this.data.projects.filter(t=>t.id!==s),this.data.sessions=this.data.sessions.filter(t=>t.project!==s),await this.save()}get sessions(){return this.data.sessions}async addSession(s){this.data.sessions.push(s),await this.save()}async updateSession(s,t){s>=0&&s<this.data.sessions.length&&(this.data.sessions[s]=t,await this.save())}async deleteSession(s){s>=0&&s<this.data.sessions.length&&(this.data.sessions.splice(s,1),await this.save())}getSessionsInRange(s,t){return this.data.sessions.filter(e=>{let i=new Date(e.start).getTime();return i>=s.getTime()&&i<t.getTime()})}getTotalTime(s){return s.reduce((t,e)=>t+new Date(e.end).getTime()-new Date(e.start).getTime(),0)}getTodaySessions(){let s=new Date;s.setHours(0,0,0,0);let t=new Date(s);return t.setDate(t.getDate()+1),this.getSessionsInRange(s,t)}getWeekSessions(){let s=new Date,t=new Date(s);t.setDate(s.getDate()-s.getDay()),t.setHours(0,0,0,0);let e=new Date(t);return e.setDate(e.getDate()+7),this.getSessionsInRange(t,e)}};var I=require("obsidian"),S=class extends I.Events{constructor(t,e){super();this.state={status:"idle",projectId:null,startTime:null};this.store=t,this.persistState=e}load(t){this.state=t}get status(){return this.state.status}get projectId(){return this.state.projectId}get startTime(){return this.state.startTime?new Date(this.state.startTime):null}get elapsed(){return this.state.status==="idle"||!this.state.startTime?0:Date.now()-new Date(this.state.startTime).getTime()}async start(t){this.state.status==="running"&&await this.stop(),this.state={status:"running",projectId:t,startTime:new Date().toISOString()},await this.persistState(this.state),this.trigger("change")}async stop(){if(this.state.status==="idle"||!this.state.projectId||!this.state.startTime)return null;let t={project:this.state.projectId,start:this.state.startTime,end:new Date().toISOString()};return await this.store.addSession(t),this.state={status:"idle",projectId:null,startTime:null},await this.persistState(this.state),this.trigger("change"),t}async discard(){this.state={status:"idle",projectId:null,startTime:null},await this.persistState(this.state),this.trigger("change")}async addManual(t,e,i){await this.store.addSession({project:t,start:e.toISOString(),end:i.toISOString()}),this.trigger("change")}};var T=class{constructor(s,t,e){this.interval=null;this.timer=t,this.store=e,this.el=s.addStatusBarItem(),this.el.addClass("time-tracker-status"),this.el.onClickEvent(()=>this.onClick()),this.timer.on("change",()=>this.render()),this.render(),this.startInterval()}startInterval(){this.interval=window.setInterval(()=>{this.timer.status==="running"&&this.render()},1e3)}destroy(){this.interval&&window.clearInterval(this.interval)}render(){var e;let{status:s,projectId:t}=this.timer;if(s==="idle")this.el.setText("\u23F1 Start timer"),this.el.removeClass("is-running");else{let i=this.store.getProject(t),r=(e=i==null?void 0:i.name)!=null?e:t,a=this.formatTime(this.timer.elapsed);this.el.setText(`\u23F1 ${r} ${a}`),this.el.addClass("is-running")}}formatTime(s){let t=Math.floor(s/1e3),e=Math.floor(t/3600),i=Math.floor(t%3600/60),r=t%60;return`${e.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}`}onClick(){this.timer.trigger("status-bar-click")}};var k=require("obsidian"),p=class extends k.Modal{constructor(t,e,i){super(t);this.timer=e,this.store=i}onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("time-tracker-project-modal"),this.timer.status==="running"?this.renderRunning(t):this.renderIdle(t)}renderIdle(t){t.createEl("h3",{text:"Start Timer"});let e=t.createDiv("project-list");for(let i of this.store.projects){let r=e.createEl("button",{text:i.name,cls:"project-btn"});r.style.setProperty("--project-color",i.color),r.onClickEvent(async()=>{await this.timer.start(i.id),this.close()})}}renderRunning(t){var l;let e=this.store.getProject(this.timer.projectId);t.createEl("h3",{text:`Tracking: ${(l=e==null?void 0:e.name)!=null?l:this.timer.projectId}`});let i=t.createDiv("actions");i.createEl("button",{text:"Stop",cls:"mod-warning"}).onClickEvent(async()=>{await this.timer.stop(),this.close()}),i.createEl("button",{text:"Discard"}).onClickEvent(async()=>{await this.timer.discard(),this.close()});let n=t.createDiv("switch-section");n.createEl("h4",{text:"Switch to:"});let P=n.createDiv("project-list");for(let d of this.store.projects){if(d.id===this.timer.projectId)continue;let h=P.createEl("button",{text:d.name,cls:"project-btn"});h.style.setProperty("--project-color",d.color),h.onClickEvent(async()=>{await this.timer.start(d.id),this.close()})}}onClose(){this.contentEl.empty()}};var x=require("obsidian"),v=class extends x.Modal{constructor(t,e){super(t);this.store=e}onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("time-tracker-stats-modal"),t.createEl("h2",{text:"Time Stats"}),this.renderSection(t,"Today",this.store.getTodaySessions()),this.renderSection(t,"This Week",this.store.getWeekSessions())}renderSection(t,e,i){var l,d;let r=t.createDiv("stats-section");r.createEl("h3",{text:e});let a=this.groupByProject(i),n=this.store.getTotalTime(i);if(Object.keys(a).length===0){r.createEl("p",{text:"No time tracked",cls:"muted"});return}let P=r.createEl("ul",{cls:"stats-list"});for(let[h,$]of Object.entries(a)){let m=this.store.getProject(h),M=this.store.getTotalTime($),E=P.createEl("li"),A=E.createSpan({cls:"color-dot"});A.style.backgroundColor=(l=m==null?void 0:m.color)!=null?l:"#888",E.createSpan({text:`${(d=m==null?void 0:m.name)!=null?d:h}: ${this.formatTime(M)}`})}r.createEl("p",{text:`Total: ${this.formatTime(n)}`,cls:"stats-total"})}groupByProject(t){var i,r;let e={};for(let a of t)((r=e[i=a.project])!=null?r:e[i]=[]).push(a);return e}formatTime(t){let e=Math.round(t/6e4),i=Math.floor(e/60),r=e%60;return i>0?`${i}h ${r}m`:`${r}m`}onClose(){this.contentEl.empty()}};var c=require("obsidian"),f=class extends c.Modal{constructor(t,e,i){var a,n;super(t);this.timer=e,this.store=i;let r=new Date;this.projectId=(n=(a=this.store.projects[0])==null?void 0:a.id)!=null?n:"",this.date=r.toISOString().split("T")[0],this.startTime="09:00",this.endTime="10:00"}onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("time-tracker-manual-modal"),t.createEl("h3",{text:"Add Time Manually"}),new c.Setting(t).setName("Project").addDropdown(e=>{for(let i of this.store.projects)e.addOption(i.id,i.name);e.setValue(this.projectId),e.onChange(i=>this.projectId=i)}),new c.Setting(t).setName("Date").addText(e=>{e.inputEl.type="date",e.setValue(this.date),e.onChange(i=>this.date=i)}),new c.Setting(t).setName("Start Time").addText(e=>{e.inputEl.type="time",e.setValue(this.startTime),e.onChange(i=>this.startTime=i)}),new c.Setting(t).setName("End Time").addText(e=>{e.inputEl.type="time",e.setValue(this.endTime),e.onChange(i=>this.endTime=i)}),new c.Setting(t).addButton(e=>{e.setButtonText("Add"),e.setCta(),e.onClick(()=>this.submit())})}async submit(){let t=new Date(`${this.date}T${this.startTime}`),e=new Date(`${this.date}T${this.endTime}`);e<=t||(await this.timer.addManual(this.projectId,t,e),this.close())}onClose(){this.contentEl.empty()}};var u=require("obsidian"),j=class extends u.PluginSettingTab{constructor(t,e){super(t,e);this.plugin=e}display(){let{containerEl:t}=this;t.empty(),t.createEl("h2",{text:"Projects"});for(let e of this.plugin.store.projects)this.renderProject(t,e);new u.Setting(t).addButton(e=>{e.setButtonText("Add Project"),e.setCta(),e.onClick(async()=>{let i=`project-${Date.now()}`;await this.plugin.store.addProject({id:i,name:"New Project",color:this.randomColor()}),this.display()})})}renderProject(t,e){let i=new u.Setting(t);i.setName(e.name);let r=i.nameEl.createSpan({cls:"color-dot"});r.style.backgroundColor=e.color,i.nameEl.prepend(r),i.addText(a=>{a.setValue(e.name),a.onChange(async n=>{await this.plugin.store.updateProject(e.id,{name:n}),i.setName(n)})}),i.addText(a=>{a.inputEl.type="color",a.inputEl.addClass("color-input"),a.setValue(e.color),a.onChange(async n=>{await this.plugin.store.updateProject(e.id,{color:n}),r.style.backgroundColor=n})}),this.plugin.store.projects.length>1&&i.addButton(a=>{a.setIcon("trash"),a.setWarning(),a.onClick(async()=>{await this.plugin.store.deleteProject(e.id),this.display()})})}randomColor(){return`hsl(${Math.floor(Math.random()*360)}, 60%, 50%)`}};var w=class extends b.Plugin{async onload(){await this.loadSettings(),this.store=new g(this),await this.store.load(),this.timer=new S(this.store,t=>this.saveTimerState(t)),this.timer.load(this.settings.timerState),this.statusBar=new T(this,this.timer,this.store),this.timer.on("status-bar-click",()=>{new p(this.app,this.timer,this.store).open()}),this.addCommand({id:"start-stop",name:"Start/Stop Timer",callback:()=>{this.timer.status==="running"?this.timer.stop():new p(this.app,this.timer,this.store).open()}}),this.addCommand({id:"show-stats",name:"Show Stats",callback:()=>new v(this.app,this.store).open()}),this.addCommand({id:"add-manual",name:"Add Time Manually",callback:()=>new f(this.app,this.timer,this.store).open()}),this.addSettingTab(new j(this.app,this))}onunload(){var t;(t=this.statusBar)==null||t.destroy()}async loadSettings(){this.settings=Object.assign({},D,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}async saveTimerState(t){this.settings.timerState=t,await this.saveSettings()}};
