"use strict";var O=Object.defineProperty;var _=Object.getOwnPropertyDescriptor;var Y=Object.getOwnPropertyNames;var U=Object.prototype.hasOwnProperty;var J=(p,r)=>{for(var e in r)O(p,e,{get:r[e],enumerable:!0})},G=(p,r,e,t)=>{if(r&&typeof r=="object"||typeof r=="function")for(let s of Y(r))!U.call(p,s)&&s!==e&&O(p,s,{get:()=>r[s],enumerable:!(t=_(r,s))||t.enumerable});return p};var q=p=>G(O({},"__esModule",{value:!0}),p);var K={};J(K,{default:()=>L});module.exports=q(K);var R=require("obsidian");var $={timerState:{status:"idle",projectId:null,startTime:null},streakTargetMins:60},H=[{id:"work",name:"Work",color:"#5f8eed",icon:"briefcase"},{id:"personal",name:"Personal",color:"#50c878",icon:"home"}],N=["briefcase","home","book","code","coffee","heart","star","folder","file-text","music","camera","globe","zap","sun","moon","cloud","pen-tool","cpu","database","terminal","graduation-cap","dumbbell","bike","car","plane","shopping-cart","dollar-sign","clock","calendar","mail","phone","map-pin","users","user","settings","wrench"];var z="time-data.json",j=class{constructor(r){this.data={projects:[],sessions:[]};this.plugin=r}get path(){return`${this.plugin.manifest.dir}/${z}`}async load(){let{adapter:r}=this.plugin.app.vault;await r.exists(this.path)?this.data=JSON.parse(await r.read(this.path)):(this.data={projects:[...H],sessions:[]},await this.save())}async save(){await this.plugin.app.vault.adapter.write(this.path,JSON.stringify(this.data,null,"	"))}get projects(){return this.data.projects}getProject(r){return this.data.projects.find(e=>e.id===r)}async addProject(r){this.data.projects.push(r),await this.save()}async updateProject(r,e){let t=this.getProject(r);t&&(Object.assign(t,e),await this.save())}async deleteProject(r){this.data.projects=this.data.projects.filter(e=>e.id!==r),this.data.sessions=this.data.sessions.filter(e=>e.project!==r),await this.save()}get sessions(){return this.data.sessions}async addSession(r){this.data.sessions.push(r),await this.save()}async updateSession(r,e){r>=0&&r<this.data.sessions.length&&(this.data.sessions[r]=e,await this.save())}async deleteSession(r){r>=0&&r<this.data.sessions.length&&(this.data.sessions.splice(r,1),await this.save())}getSessionsInRange(r,e){return this.data.sessions.filter(t=>{let s=new Date(t.start).getTime();return s>=r.getTime()&&s<e.getTime()})}getTotalTime(r){return r.reduce((e,t)=>e+new Date(t.end).getTime()-new Date(t.start).getTime(),0)}getTodaySessions(){let r=new Date;r.setHours(0,0,0,0);let e=new Date(r);return e.setDate(e.getDate()+1),this.getSessionsInRange(r,e)}getWeekSessions(){let r=new Date,e=(r.getDay()+6)%7,t=new Date(r);t.setDate(r.getDate()-e),t.setHours(0,0,0,0);let s=new Date(t);return s.setDate(s.getDate()+7),this.getSessionsInRange(t,s)}getMonthSessions(){let r=new Date,e=new Date(r.getFullYear(),r.getMonth(),1),t=new Date(r.getFullYear(),r.getMonth()+1,1);return this.getSessionsInRange(e,t)}getStreak(r){let e=new Date;e.setHours(0,0,0,0);let t=0,s=new Date(e);s.setDate(e.getDate()+1);let i=this.getSessionsInRange(e,s);this.getTotalTime(i)>=r&&t++;let o=new Date(e);for(o.setDate(o.getDate()-1);;){let n=new Date(o);n.setDate(o.getDate()+1);let d=this.getSessionsInRange(o,n);if(this.getTotalTime(d)<r)break;t++,o.setDate(o.getDate()-1)}return t}};var V=require("obsidian"),P=class extends V.Events{constructor(e,t){super();this.state={status:"idle",projectId:null,startTime:null};this.store=e,this.persistState=t}load(e){this.state=e}get status(){return this.state.status}get projectId(){return this.state.projectId}get startTime(){return this.state.startTime?new Date(this.state.startTime):null}get elapsed(){return this.state.status==="idle"||!this.state.startTime?0:Date.now()-new Date(this.state.startTime).getTime()}async start(e){this.state.status==="running"&&await this.stop(),this.state={status:"running",projectId:e,startTime:new Date().toISOString()},await this.persistState(this.state),this.trigger("change")}async stop(){if(this.state.status==="idle"||!this.state.projectId||!this.state.startTime)return null;let e={project:this.state.projectId,start:this.state.startTime,end:new Date().toISOString()};return await this.store.addSession(e),this.state={status:"idle",projectId:null,startTime:null},await this.persistState(this.state),this.trigger("change"),e}async discard(){this.state={status:"idle",projectId:null,startTime:null},await this.persistState(this.state),this.trigger("change")}async addManual(e,t,s){await this.store.addSession({project:e,start:t.toISOString(),end:s.toISOString()}),this.trigger("change")}};var M=class{constructor(r,e,t){this.interval=null;this.timer=e,this.store=t,this.el=r.addStatusBarItem(),this.el.addClass("time-tracker-status"),this.el.onClickEvent(()=>this.onClick()),this.timer.on("change",()=>this.render()),this.render(),this.startInterval()}startInterval(){this.interval=window.setInterval(()=>{this.timer.status==="running"&&this.render()},1e3)}destroy(){this.interval&&window.clearInterval(this.interval)}render(){var t;let{status:r,projectId:e}=this.timer;if(r==="idle")this.el.setText("\u23F1 No timer"),this.el.removeClass("is-running");else{let s=this.store.getProject(e),i=(t=s==null?void 0:s.name)!=null?t:e,a=this.formatTime(this.timer.elapsed);this.el.setText(`\u23F1 ${i} ${a}`),this.el.addClass("is-running")}}formatTime(r){let e=Math.floor(r/1e3),t=Math.floor(e/3600),s=Math.floor(e%3600/60),i=e%60;return`${t.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}`}onClick(){this.timer.trigger("status-bar-click")}};var W=require("obsidian"),E=class extends W.Modal{constructor(e,t){super(e);this.store=t}onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("time-tracker-stats-modal"),e.createEl("h2",{text:"Time Stats"}),this.renderSection(e,"Today",this.store.getTodaySessions()),this.renderSection(e,"This Week",this.store.getWeekSessions())}renderSection(e,t,s){var d,l;let i=e.createDiv("stats-section");i.createEl("h3",{text:t});let a=this.groupByProject(s),o=this.store.getTotalTime(s);if(Object.keys(a).length===0){i.createEl("p",{text:"No time tracked",cls:"muted"});return}let n=i.createEl("ul",{cls:"stats-list"});for(let[m,g]of Object.entries(a)){let c=this.store.getProject(m),u=this.store.getTotalTime(g),h=n.createEl("li"),D=h.createSpan({cls:"color-dot"});D.style.backgroundColor=(d=c==null?void 0:c.color)!=null?d:"#888",h.createSpan({text:`${(l=c==null?void 0:c.name)!=null?l:m}: ${this.formatTime(u)}`})}i.createEl("p",{text:`Total: ${this.formatTime(o)}`,cls:"stats-total"})}groupByProject(e){var s,i;let t={};for(let a of e)((i=t[s=a.project])!=null?i:t[s]=[]).push(a);return t}formatTime(e){let t=Math.round(e/6e4),s=Math.floor(t/60),i=t%60;return s>0?`${s}h ${i}m`:`${i}m`}onClose(){this.contentEl.empty()}};var w=require("obsidian"),C=class extends w.Modal{constructor(e,t,s){var a,o;super(e);this.timer=t,this.store=s;let i=new Date;this.projectId=(o=(a=this.store.projects[0])==null?void 0:a.id)!=null?o:"",this.date=i.toISOString().split("T")[0],this.startTime="09:00",this.endTime="10:00"}onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("time-tracker-manual-modal"),e.createEl("h3",{text:"Add Time Manually"}),new w.Setting(e).setName("Project").addDropdown(t=>{for(let s of this.store.projects)t.addOption(s.id,s.name);t.setValue(this.projectId),t.onChange(s=>this.projectId=s)}),new w.Setting(e).setName("Date").addText(t=>{t.inputEl.type="date",t.setValue(this.date),t.onChange(s=>this.date=s)}),new w.Setting(e).setName("Start Time").addText(t=>{t.inputEl.type="time",t.setValue(this.startTime),t.onChange(s=>this.startTime=s)}),new w.Setting(e).setName("End Time").addText(t=>{t.inputEl.type="time",t.setValue(this.endTime),t.onChange(s=>this.endTime=s)}),new w.Setting(e).addButton(t=>{t.setButtonText("Add"),t.setCta(),t.onClick(()=>this.submit())})}async submit(){let e=new Date(`${this.date}T${this.startTime}`),t=new Date(`${this.date}T${this.endTime}`);t<=e||(await this.timer.addManual(this.projectId,e,t),this.close())}onClose(){this.contentEl.empty()}};var v=require("obsidian");var I=class extends v.PluginSettingTab{constructor(e,t){super(e,t);this.plugin=t}display(){let{containerEl:e}=this;e.empty(),e.createEl("h2",{text:"General"}),new v.Setting(e).setName("Streak target").setDesc("Minimum minutes per day to count towards streak").addText(t=>{t.inputEl.type="number",t.inputEl.min="1",t.setValue(String(this.plugin.settings.streakTargetMins)),t.onChange(async s=>{let i=parseInt(s)||60;this.plugin.settings.streakTargetMins=i,await this.plugin.saveSettings()})}),e.createEl("h2",{text:"Projects"});for(let t of this.plugin.store.projects)this.renderProject(e,t);new v.Setting(e).addButton(t=>{t.setButtonText("Add Project"),t.setCta(),t.onClick(async()=>{let s=`project-${Date.now()}`;await this.plugin.store.addProject({id:s,name:"New Project",color:this.randomColor(),icon:"folder"}),this.display()})})}renderProject(e,t){let s=new v.Setting(e);s.setName(t.name);let i=s.nameEl.createSpan({cls:"project-icon"});(0,v.setIcon)(i,t.icon||"folder"),s.nameEl.prepend(i),s.addDropdown(a=>{for(let o of N)a.addOption(o,o);a.setValue(t.icon||"folder"),a.onChange(async o=>{await this.plugin.store.updateProject(t.id,{icon:o}),i.empty(),(0,v.setIcon)(i,o)})}),s.addText(a=>{a.setValue(t.name),a.onChange(async o=>{await this.plugin.store.updateProject(t.id,{name:o}),s.setName(o)})}),s.addText(a=>{a.inputEl.type="color",a.inputEl.addClass("color-input"),a.setValue(t.color),a.onChange(async o=>{await this.plugin.store.updateProject(t.id,{color:o})})}),this.plugin.store.projects.length>1&&s.addButton(a=>{a.setIcon("trash"),a.setWarning(),a.onClick(async()=>{await this.plugin.store.deleteProject(t.id),this.display()})})}randomColor(){return`hsl(${Math.floor(Math.random()*360)}, 60%, 50%)`}};var T=require("obsidian"),b="time-tracker-sidebar",x=class extends T.ItemView{constructor(e,t,s,i){super(e);this.interval=null;this.activeTab="timer";this.analyticsMode="week";this.timer=t,this.store=s,this.plugin=i}getViewType(){return b}getDisplayText(){return"Time Tracker"}getIcon(){return"clock"}async onOpen(){this.timer.on("change",()=>this.render()),this.startInterval(),this.render()}async onClose(){this.interval&&window.clearInterval(this.interval)}startInterval(){this.interval=window.setInterval(()=>{this.timer.status==="running"&&this.render()},1e3)}render(){let e=this.containerEl.children[1];e.empty(),e.addClass("time-tracker-sidebar"),this.renderTabs(e),this.activeTab==="timer"?this.renderTimerView(e):this.renderAnalyticsView(e)}renderTabs(e){let t=e.createDiv("sidebar-tabs"),s=t.createDiv("sidebar-tab");s.setText("Timer"),this.activeTab==="timer"&&s.addClass("active"),s.onClickEvent(()=>{this.activeTab="timer",this.render()});let i=t.createDiv("sidebar-tab");i.setText("Analytics"),this.activeTab==="analytics"&&i.addClass("active"),i.onClickEvent(()=>{this.activeTab="analytics",this.render()})}renderTimerView(e){let t=e.createDiv("timer-view");this.renderTimer(t),this.renderToday(t)}renderTimer(e){var s,i;let t=e.createDiv("timer-section");if(this.timer.status==="idle"){let a=t.createDiv("project-buttons");for(let o of this.store.projects){let n=a.createEl("button",{cls:"project-btn"});n.style.setProperty("--project-color",o.color),n.style.setProperty("--icon-color",this.getContrastColor(o.color));let d=n.createDiv("project-btn-icon");(0,T.setIcon)(d,o.icon||"play");let l=n.createDiv("project-btn-content");l.createSpan("project-btn-name").setText(o.name);let m=l.createDiv("project-btn-add");(0,T.setIcon)(m,"plus"),m.onClickEvent(g=>{g.stopPropagation(),new A(this.app,this.store,o.id,o.name,()=>this.render()).open()}),n.onClickEvent(()=>this.timer.start(o.id))}}else{let a=this.store.getProject(this.timer.projectId);t.addClass("running"),t.style.setProperty("--active-color",(s=a==null?void 0:a.color)!=null?s:"#888");let o=t.createDiv("timer-active-header");o.createSpan("timer-active-label").setText("Tracking"),o.createSpan("timer-active-project").setText((i=a==null?void 0:a.name)!=null?i:"Unknown"),t.createDiv("timer-display").setText(this.formatTime(this.timer.elapsed));let d=t.createDiv("timer-actions"),l=d.createEl("button",{cls:"timer-btn stop"});l.createSpan("timer-btn-icon").setText("\u25A0"),l.createSpan().setText("Stop"),l.onClickEvent(()=>this.timer.stop());let m=d.createEl("button",{cls:"timer-btn switch"});m.createSpan("timer-btn-icon").setText("\u21BB"),m.createSpan().setText("Switch"),m.onClickEvent(g=>this.showSwitchMenu(m,g))}}renderToday(e){var c,u;let t=e.createDiv("today-section"),s=this.store.getTodaySessions(),i=this.store.getTotalTime(s),a=this.timer.status==="running"?this.timer.elapsed:0,o=i+a,n=t.createDiv("today-header");n.createSpan("today-label").setText("Today"),n.createSpan("today-total").setText(this.formatTimeHM(o));let d=8*60*60*1e3,l=Math.min(o/d,1),g=t.createDiv("today-progress").createDiv("today-progress-fill");if(g.style.width=`${l*100}%`,this.timer.status==="idle"){let h=t.createDiv("today-breakdown");if(s.length===0)h.createDiv("today-empty").setText("No sessions yet today");else{let D=this.groupByProject(s);for(let[S,y]of Object.entries(D)){let f=this.store.getProject(S),B=this.store.getTotalTime(y),k=h.createDiv("today-row"),F=k.createSpan("today-dot");F.style.backgroundColor=(c=f==null?void 0:f.color)!=null?c:"#888",k.createSpan("today-name").setText((u=f==null?void 0:f.name)!=null?u:S),k.createSpan("today-time").setText(this.formatTimeHM(B))}}}}renderAnalyticsView(e){let t=e.createDiv("analytics-view");this.renderChart(t),this.renderStats(t),this.renderProjectSummary(t)}renderChart(e){let t=e.createDiv("analytics-section"),s=this.analyticsMode==="week"?this.store.getWeekSessions():this.store.getMonthSessions(),i=this.store.getTotalTime(s),a=t.createDiv("analytics-header"),o=a.createDiv("analytics-toggle"),n=o.createEl("button",{cls:"toggle-btn",text:"W"});this.analyticsMode==="week"&&n.addClass("active"),n.onClickEvent(()=>{this.analyticsMode="week",this.render()});let d=o.createEl("button",{cls:"toggle-btn",text:"M"});this.analyticsMode==="month"&&d.addClass("active"),d.onClickEvent(()=>{this.analyticsMode="month",this.render()}),a.createSpan("analytics-total").setText(this.formatTimeHM(i));let l=this.analyticsMode==="week"?this.getWeekDailyData():this.getMonthDailyData(),m=Math.max(...l.map(c=>c.total),1),g=t.createDiv("week-chart");l.forEach(c=>{let u=g.createDiv("week-bar");c.isToday&&u.addClass("today");let h=u.createDiv("week-bar-stack");h.dataset.tooltip=this.formatTimeHM(c.total);let D=c.total/m*100;if(h.style.height=`${Math.max(D,c.total>0?4:2)}%`,c.total>0)for(let S of c.projects){let y=h.createDiv("stack-segment");y.style.height=`${S.time/c.total*100}%`,y.style.backgroundColor=S.color}u.createDiv("week-bar-label").setText(c.label)})}renderStats(e){let t=e.createDiv("analytics-section stats-section"),s=this.analyticsMode==="week"?this.store.getWeekSessions():this.store.getMonthSessions(),i=this.store.getTotalTime(s),a=this.analyticsMode==="week"?7:new Date().getDate(),o=i/a,n=this.plugin.settings.streakTargetMins*60*1e3,d=this.store.getStreak(n),l=t.createDiv("stats-grid"),m=l.createDiv("stat-item");m.createDiv("stat-value").setText(this.formatTimeHM(o)),m.createDiv("stat-label").setText("Daily Avg");let g=l.createDiv("stat-item");g.createDiv("stat-value").setText(`${d}`),g.createDiv("stat-label").setText(d===1?"Day Streak":"Days Streak")}renderProjectSummary(e){var l,m,g;let t=e.createDiv("analytics-section");t.createDiv("analytics-header").createSpan("analytics-label").setText("By Project");let i=this.analyticsMode==="week"?this.store.getWeekSessions():this.store.getMonthSessions(),a=this.store.getTotalTime(i);if(i.length===0){t.createDiv("analytics-empty").setText("No data");return}let o=this.groupByProject(i),n=t.createDiv("project-breakdown"),d=Object.entries(o).map(([c,u])=>({id:c,time:this.store.getTotalTime(u)})).sort((c,u)=>u.time-c.time);for(let{id:c,time:u}of d){let h=this.store.getProject(c),D=a>0?u/a*100:0,S=n.createDiv("breakdown-row"),y=S.createDiv("breakdown-info"),f=y.createSpan("breakdown-dot");f.style.backgroundColor=(l=h==null?void 0:h.color)!=null?l:"#888",y.createSpan("breakdown-name").setText((m=h==null?void 0:h.name)!=null?m:c),y.createSpan("breakdown-time").setText(this.formatTimeHM(u));let k=S.createDiv("breakdown-bar").createDiv("breakdown-bar-fill");k.style.width=`${D}%`,k.style.backgroundColor=(g=h==null?void 0:h.color)!=null?g:"#888"}}getWeekDailyData(){let e=new Date,t=(e.getDay()+6)%7,s=["M","T","W","T","F","S","S"],i=[];for(let a=0;a<7;a++){let o=new Date(e);o.setDate(e.getDate()-t+a),o.setHours(0,0,0,0);let n=new Date(o);n.setDate(o.getDate()+1);let d=this.store.getSessionsInRange(o,n),l=this.store.getTotalTime(d),m=this.getProjectBreakdown(d);i.push({label:s[a],total:l,isToday:a===t,projects:m})}return i}getMonthDailyData(){let e=new Date,t=new Date(e.getFullYear(),e.getMonth()+1,0).getDate(),s=[];for(let i=1;i<=t;i++){let a=new Date(e.getFullYear(),e.getMonth(),i),o=new Date(e.getFullYear(),e.getMonth(),i+1),n=this.store.getSessionsInRange(a,o),d=this.store.getTotalTime(n),l=this.getProjectBreakdown(n);s.push({label:i.toString(),total:d,isToday:i===e.getDate(),projects:l})}return s}getProjectBreakdown(e){let t=this.groupByProject(e);return Object.entries(t).map(([s,i])=>{var a,o;return{color:(o=(a=this.store.getProject(s))==null?void 0:a.color)!=null?o:"#888",time:this.store.getTotalTime(i)}}).sort((s,i)=>i.time-s.time)}showSwitchMenu(e,t){let s=new T.Menu;for(let i of this.store.projects)i.id!==this.timer.projectId&&s.addItem(a=>{a.setTitle(i.name),a.onClick(()=>this.timer.start(i.id))});s.showAtMouseEvent(t)}groupByProject(e){var s,i;let t={};for(let a of e)((i=t[s=a.project])!=null?i:t[s]=[]).push(a);return t}formatTime(e){let t=Math.floor(e/1e3),s=Math.floor(t/3600),i=Math.floor(t%3600/60),a=t%60;return`${s.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`}formatTimeHM(e){let t=Math.round(e/6e4),s=Math.floor(t/60),i=t%60;return s>0?`${s}h ${i}m`:`${i}m`}getContrastColor(e){let t=parseInt(e.slice(1,3),16),s=parseInt(e.slice(3,5),16),i=parseInt(e.slice(5,7),16);return(.299*t+.587*s+.114*i)/255>.5?"#2e2e2e":"#ffffff"}},A=class extends T.Modal{constructor(e,t,s,i,a){super(e);this.minutes=30;this.store=t,this.projectId=s,this.projectName=i,this.onSave=a}onOpen(){let{contentEl:e}=this;e.addClass("quick-add-modal"),e.createEl("h3",{text:`Add time to ${this.projectName}`}),new T.Setting(e).setName("Minutes").addText(t=>{t.inputEl.type="number",t.inputEl.min="1",t.setValue("30"),t.onChange(s=>this.minutes=parseInt(s)||30),t.inputEl.focus(),t.inputEl.select()}),new T.Setting(e).addButton(t=>{t.setButtonText("Add"),t.setCta(),t.onClick(()=>this.save())})}async save(){let e=new Date,t=new Date(e.getTime()-this.minutes*60*1e3);await this.store.addSession({project:this.projectId,start:t.toISOString(),end:e.toISOString()}),this.onSave(),this.close()}onClose(){this.contentEl.empty()}};var L=class extends R.Plugin{async onload(){await this.loadSettings(),this.store=new j(this),await this.store.load(),this.timer=new P(this.store,e=>this.saveTimerState(e)),this.timer.load(this.settings.timerState),this.registerView(b,e=>new x(e,this.timer,this.store,this)),this.statusBar=new M(this,this.timer,this.store),this.timer.on("status-bar-click",()=>this.activateSidebar()),this.addCommand({id:"open-tracker",name:"Open Time Tracker",callback:()=>this.activateSidebar()}),this.addCommand({id:"start-stop",name:"Start/Stop Timer",callback:()=>{this.timer.status==="running"?this.timer.stop():this.activateSidebar()}}),this.addCommand({id:"show-stats",name:"Show Stats",callback:()=>new E(this.app,this.store).open()}),this.addCommand({id:"add-manual",name:"Add Time Manually",callback:()=>new C(this.app,this.timer,this.store).open()}),this.addSettingTab(new I(this.app,this)),this.app.workspace.onLayoutReady(()=>this.initSidebar())}onunload(){var e;(e=this.statusBar)==null||e.destroy(),this.app.workspace.detachLeavesOfType(b)}async activateSidebar(){let{workspace:e}=this.app,t=e.getLeavesOfType(b)[0];if(!t){let s=e.getRightLeaf(!1);s&&(t=s,await t.setViewState({type:b,active:!0}))}t&&e.revealLeaf(t)}async initSidebar(){this.app.workspace.getLeavesOfType(b).length===0&&await this.activateSidebar()}async loadSettings(){this.settings=Object.assign({},$,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}async saveTimerState(e){this.settings.timerState=e,await this.saveSettings()}};
