"use strict";var G=Object.defineProperty;var tt=Object.getOwnPropertyDescriptor;var et=Object.getOwnPropertyNames;var st=Object.prototype.hasOwnProperty;var it=(c,s)=>{for(var t in s)G(c,t,{get:s[t],enumerable:!0})},at=(c,s,t,e)=>{if(s&&typeof s=="object"||typeof s=="function")for(let i of et(s))!st.call(c,i)&&i!==t&&G(c,i,{get:()=>s[i],enumerable:!(e=tt(s,i))||e.enumerable});return c};var rt=c=>at(G({},"__esModule",{value:!0}),c);var ot={};it(ot,{default:()=>N});module.exports=rt(ot);var Z=require("obsidian");var Y={timerState:{status:"idle",projectId:null,startTime:null},dailyGoalMins:[240,480,480,480,480,480,240]},_=[{id:"work",name:"Work",color:"#5f8eed",icon:"briefcase"},{id:"personal",name:"Personal",color:"#50c878",icon:"home"}],U=["briefcase","home","book","code","coffee","heart","star","folder","file-text","music","camera","globe","zap","sun","moon","cloud","pen-tool","cpu","database","terminal","graduation-cap","dumbbell","bike","car","plane","shopping-cart","dollar-sign","clock","calendar","mail","phone","map-pin","users","user","settings","wrench"];function C(c){let s=Math.floor(c/1e3),t=Math.floor(s/3600),e=Math.floor(s%3600/60),i=s%60;return`${t.toString().padStart(2,"0")}:${e.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}`}function S(c){let s=Math.round(c/6e4),t=Math.floor(s/60),e=s%60;return t>0?`${t}h ${e}m`:`${e}m`}function V(c){return`${String(c.getHours()).padStart(2,"0")}:${String(c.getMinutes()).padStart(2,"0")}`}function j(c){var t,e;let s={};for(let i of c)((e=s[t=i.project])!=null?e:s[t]=[]).push(i);return s}function J(c,s,t){let e=Math.max(new Date(c.start).getTime(),s.getTime()),i=Math.min(new Date(c.end).getTime(),t.getTime());return Math.max(i-e,0)}function z(c){let s=parseInt(c.slice(1,3),16),t=parseInt(c.slice(3,5),16),e=parseInt(c.slice(5,7),16);return(.299*s+.587*t+.114*e)/255>.5?"#2e2e2e":"#ffffff"}var nt="time-data.json",A=class{constructor(s){this.data={projects:[],sessions:[]};this.plugin=s}get path(){return`${this.plugin.manifest.dir}/${nt}`}async load(){let{adapter:s}=this.plugin.app.vault;await s.exists(this.path)?this.data=JSON.parse(await s.read(this.path)):(this.data={projects:[..._],sessions:[]},await this.save())}async save(){await this.plugin.app.vault.adapter.write(this.path,JSON.stringify(this.data,null,"	"))}get projects(){return this.data.projects}getProject(s){return this.data.projects.find(t=>t.id===s)}async addProject(s){this.data.projects.push(s),await this.save()}async updateProject(s,t){let e=this.getProject(s);e&&(Object.assign(e,t),await this.save())}async deleteProject(s){this.data.projects=this.data.projects.filter(t=>t.id!==s),this.data.sessions=this.data.sessions.filter(t=>t.project!==s),await this.save()}get sessions(){return this.data.sessions}async addSession(s){this.data.sessions.push(s),await this.save()}async updateSession(s,t){s>=0&&s<this.data.sessions.length&&(this.data.sessions[s]=t,await this.save())}async deleteSession(s){s>=0&&s<this.data.sessions.length&&(this.data.sessions.splice(s,1),await this.save())}getSessionsWithIndices(s,t){return this.data.sessions.map((e,i)=>({index:i,session:e})).filter(({session:e})=>new Date(e.start).getTime()<t.getTime()&&new Date(e.end).getTime()>s.getTime())}getSessionsInRange(s,t){return this.data.sessions.filter(e=>new Date(e.start).getTime()<t.getTime()&&new Date(e.end).getTime()>s.getTime())}getTotalTime(s){return s.reduce((t,e)=>t+new Date(e.end).getTime()-new Date(e.start).getTime(),0)}getTotalTimeInRange(s,t,e){return s.reduce((i,n)=>i+J(n,t,e),0)}getTodaySessions(){let s=new Date;s.setHours(0,0,0,0);let t=new Date(s);return t.setDate(t.getDate()+1),this.getSessionsInRange(s,t)}getWeekSessions(){let s=new Date,t=(s.getDay()+6)%7,e=new Date(s);e.setDate(s.getDate()-t),e.setHours(0,0,0,0);let i=new Date(e);return i.setDate(i.getDate()+7),this.getSessionsInRange(e,i)}getMonthSessions(){let s=new Date,t=new Date(s.getFullYear(),s.getMonth(),1),e=new Date(s.getFullYear(),s.getMonth()+1,1);return this.getSessionsInRange(t,e)}};var q=require("obsidian"),L=class extends q.Events{constructor(t,e){super();this.state={status:"idle",projectId:null,startTime:null};this.store=t,this.persistState=e}load(t){this.state=t}get status(){return this.state.status}get projectId(){return this.state.projectId}get startTime(){return this.state.startTime?new Date(this.state.startTime):null}get elapsed(){return this.state.status==="idle"||!this.state.startTime?0:Date.now()-new Date(this.state.startTime).getTime()}async start(t){this.state.status==="running"&&await this.stop(),this.state={status:"running",projectId:t,startTime:new Date().toISOString()},await this.persistState(this.state),this.trigger("change")}async stop(){if(this.state.status==="idle"||!this.state.projectId||!this.state.startTime)return;let t={project:this.state.projectId,start:this.state.startTime,end:new Date().toISOString()};await this.store.addSession(t),this.state={status:"idle",projectId:null,startTime:null},await this.persistState(this.state),this.trigger("change")}async discard(){this.state={status:"idle",projectId:null,startTime:null},await this.persistState(this.state),this.trigger("change")}};var H=class{constructor(s,t,e){this.interval=null;this.timer=t,this.store=e,this.el=s.addStatusBarItem(),this.el.addClass("time-tracker-status"),this.el.onClickEvent(()=>this.onClick()),this.changeRef=this.timer.on("change",()=>this.render()),this.render(),this.startInterval()}startInterval(){this.interval=window.setInterval(()=>{this.timer.status==="running"&&this.render()},1e3)}destroy(){this.interval&&window.clearInterval(this.interval),this.timer.offref(this.changeRef)}render(){var e;let{status:s,projectId:t}=this.timer;if(s==="idle")this.el.setText("\u23F1 No timer"),this.el.removeClass("is-running");else{let i=this.store.getProject(t),n=(e=i==null?void 0:i.name)!=null?e:t,a=C(this.timer.elapsed);this.el.setText(`\u23F1 ${n} ${a}`),this.el.addClass("is-running")}}onClick(){this.timer.trigger("status-bar-click")}};var K=require("obsidian");var R=class extends K.Modal{constructor(t,e){super(t);this.store=e}onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("time-tracker-stats-modal"),t.createEl("h2",{text:"Time Stats"});let e=new Date;e.setHours(0,0,0,0);let i=new Date(e);i.setDate(i.getDate()+1);let n=new Date,a=(n.getDay()+6)%7,r=new Date(n);r.setDate(n.getDate()-a),r.setHours(0,0,0,0);let o=new Date(r);o.setDate(o.getDate()+7),this.renderSection(t,"Today",this.store.getTodaySessions(),e,i),this.renderSection(t,"This Week",this.store.getWeekSessions(),r,o)}renderSection(t,e,i,n,a){var g,d;let r=t.createDiv("stats-section");r.createEl("h3",{text:e});let o=j(i),l=this.store.getTotalTimeInRange(i,n,a);if(Object.keys(o).length===0){r.createEl("p",{text:"No time tracked",cls:"muted"});return}let m=r.createEl("ul",{cls:"stats-list"});for(let[v,T]of Object.entries(o)){let p=this.store.getProject(v),h=this.store.getTotalTimeInRange(T,n,a),u=m.createEl("li"),D=u.createSpan({cls:"color-dot"});D.style.backgroundColor=(g=p==null?void 0:p.color)!=null?g:"#888",u.createSpan({text:`${(d=p==null?void 0:p.name)!=null?d:v}: ${S(h)}`})}r.createEl("p",{text:`Total: ${S(l)}`,cls:"stats-total"})}onClose(){this.contentEl.empty()}};var Q=require("obsidian");var w=class extends Q.Modal{constructor(t,e,i,n){var a,r,o,l;super(t);this.durationEl=null;if(this.timer=e,this.store=i,this.opts=n!=null?n:{},this.isEditing){let m=this.opts.session,g=new Date(m.start),d=new Date(m.end);this.projectId=m.project,this.date=this.toDateStr(g),this.startTime=this.toTimeStr(g),this.endTime=this.toTimeStr(d)}else{let m=(a=this.opts.date)!=null?a:new Date;this.projectId=(l=(o=this.opts.projectId)!=null?o:(r=this.store.projects[0])==null?void 0:r.id)!=null?l:"",this.date=this.toDateStr(m);let g=m.getHours(),d=Math.max(g-1,0);this.startTime=`${String(d).padStart(2,"0")}:00`,this.endTime=`${String(g).padStart(2,"0")}:00`}}get isEditing(){return this.opts.editIndex!==void 0&&this.opts.session!==void 0}onOpen(){let{contentEl:t}=this;t.addClass("time-tracker-add-modal"),t.createEl("h3",{text:this.isEditing?"Edit Session":"Add Time"});let e=t.createDiv("add-modal-field");e.createEl("label",{text:"Project",cls:"add-modal-label"});let i=e.createEl("select",{cls:"add-modal-select"});for(let d of this.store.projects){let v=i.createEl("option",{text:d.name,value:d.id});d.id===this.projectId&&(v.selected=!0)}i.addEventListener("change",()=>{this.projectId=i.value});let n=t.createDiv("add-modal-field");n.createEl("label",{text:"Date",cls:"add-modal-label"});let a=n.createEl("input",{cls:"add-modal-input",type:"date",value:this.date});a.addEventListener("change",()=>{this.date=a.value});let r=t.createDiv("add-modal-field");r.createEl("label",{text:"Time",cls:"add-modal-label"});let o=r.createDiv("add-modal-time-row"),l=o.createEl("input",{cls:"add-modal-input",type:"time",value:this.startTime});this.durationEl=o.createEl("span",{cls:"add-modal-duration"});let m=o.createEl("input",{cls:"add-modal-input",type:"time",value:this.endTime});l.addEventListener("change",()=>{this.startTime=l.value,this.updateDuration()}),m.addEventListener("change",()=>{this.endTime=m.value,this.updateDuration()}),this.updateDuration(),t.createEl("button",{text:this.isEditing?"Save":"Add",cls:"add-modal-submit mod-cta"}).addEventListener("click",()=>this.submit())}updateDuration(){if(!this.durationEl)return;let t=this.computeDurationMs();this.durationEl.setText(t>0?S(t):"\u2014")}computeDurationMs(){let t=new Date(`${this.date}T${this.startTime}`),e=new Date(`${this.date}T${this.endTime}`);return e<=t&&(e=new Date(e.getTime()+864e5)),e.getTime()-t.getTime()}async submit(){let t=new Date(`${this.date}T${this.startTime}`),e=new Date(`${this.date}T${this.endTime}`);e<=t&&(e=new Date(e.getTime()+864e5));let i={project:this.projectId,start:t.toISOString(),end:e.toISOString()};this.isEditing?await this.store.updateSession(this.opts.editIndex,i):await this.store.addSession(i),this.timer.trigger("change"),this.close()}toDateStr(t){return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`}toTimeStr(t){return`${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}`}onClose(){this.contentEl.empty()}};var f=require("obsidian");var $=class extends f.PluginSettingTab{constructor(t,e){super(t,e);this.plugin=e}display(){let{containerEl:t}=this;t.empty(),t.createEl("h2",{text:"General"});let i=new f.Setting(t).setName("Daily goal").setDesc("Target minutes per day (S M T W T F S)").controlEl.createDiv("daily-goal-row"),n=["S","M","T","W","T","F","S"],a=this.plugin.settings.dailyGoalMins;for(let r=0;r<7;r++){let o=i.createDiv("daily-goal-col");o.createEl("label",{text:n[r],cls:"daily-goal-label"});let l=o.createEl("input",{cls:"daily-goal-input"});l.type="number",l.min="0",l.value=String(a[r]);let m=r;l.addEventListener("change",async()=>{this.plugin.settings.dailyGoalMins[m]=parseInt(l.value)||0,await this.plugin.saveSettings()})}t.createEl("h2",{text:"Projects"});for(let r of this.plugin.store.projects)this.renderProject(t,r);new f.Setting(t).addButton(r=>{r.setButtonText("Add Project"),r.setCta(),r.onClick(async()=>{let o=`project-${Date.now()}`;await this.plugin.store.addProject({id:o,name:"New Project",color:this.randomColor(),icon:"folder"}),this.display()})})}renderProject(t,e){let i=new f.Setting(t);i.setName(e.name);let n=i.nameEl.createSpan({cls:"project-icon"});(0,f.setIcon)(n,e.icon||"folder"),i.nameEl.prepend(n),i.addDropdown(a=>{for(let r of U)a.addOption(r,r);a.setValue(e.icon||"folder"),a.onChange(async r=>{await this.plugin.store.updateProject(e.id,{icon:r}),n.empty(),(0,f.setIcon)(n,r)})}),i.addText(a=>{a.setValue(e.name),a.onChange(async r=>{await this.plugin.store.updateProject(e.id,{name:r}),i.setName(r)})}),i.addText(a=>{a.inputEl.type="color",a.inputEl.addClass("color-input"),a.setValue(e.color),a.onChange(async r=>{await this.plugin.store.updateProject(e.id,{color:r})})}),this.plugin.store.projects.length>1&&i.addButton(a=>{a.setIcon("trash"),a.setWarning(),a.onClick(async()=>{await this.plugin.store.deleteProject(e.id),this.display()})})}randomColor(){return`hsl(${Math.floor(Math.random()*360)}, 60%, 50%)`}};var X=require("obsidian");var x=require("obsidian");var B=class{constructor(s,t,e){this.app=s;this.timer=t;this.store=e}render(s,t){this.viewDate=t;let e=s.createDiv("timer-section");this.timer.status==="idle"?this.renderIdle(e):this.renderRunning(e)}renderIdle(s){let t=s.createDiv("project-buttons");for(let e of this.store.projects){let i=t.createEl("button",{cls:"project-btn"});i.style.setProperty("--project-color",e.color),i.style.setProperty("--icon-color",z(e.color));let n=i.createDiv("project-btn-icon");(0,x.setIcon)(n,e.icon||"play");let a=i.createDiv("project-btn-content");a.createSpan("project-btn-name").setText(e.name);let r=a.createDiv("project-btn-add");(0,x.setIcon)(r,"plus"),r.onClickEvent(o=>{o.stopPropagation(),new w(this.app,this.timer,this.store,{projectId:e.id,date:this.viewDate}).open()}),i.onClickEvent(()=>this.timer.start(e.id))}}renderRunning(s){var o,l;let t=this.store.getProject(this.timer.projectId);s.addClass("running"),s.style.setProperty("--active-color",(o=t==null?void 0:t.color)!=null?o:"#888");let e=s.createDiv("timer-active-header");e.createSpan("timer-active-label").setText("Tracking"),e.createSpan("timer-active-project").setText((l=t==null?void 0:t.name)!=null?l:"Unknown"),s.createDiv("timer-display").setText(C(this.timer.elapsed));let n=s.createDiv("timer-actions"),a=n.createEl("button",{cls:"timer-btn stop"});a.createSpan("timer-btn-icon").setText("\u25A0"),a.createSpan().setText("Stop"),a.onClickEvent(()=>this.timer.stop());let r=n.createEl("button",{cls:"timer-btn switch"});r.createSpan("timer-btn-icon").setText("\u21BB"),r.createSpan().setText("Switch"),r.onClickEvent(m=>this.showSwitchMenu(m))}showSwitchMenu(s){let t=new x.Menu;for(let e of this.store.projects)e.id!==this.timer.projectId&&t.addItem(i=>{i.setTitle(e.name),i.onClick(()=>this.timer.start(e.id))});t.showAtMouseEvent(s)}};var M=require("obsidian");var O=class{constructor(s,t,e,i){this.app=s;this.timer=t;this.store=e;this.plugin=i}render(s,t,e){let i=s.createDiv("today-section"),n=new Date(t);n.setHours(0,0,0,0);let a=new Date(n);a.setDate(a.getDate()+1);let r=this.store.getSessionsWithIndices(n,a),o=r.map(d=>d.session),l=this.store.getTotalTimeInRange(o,n,a),m=0;if(e&&this.timer.status==="running"&&this.timer.startTime){let d=Math.max(this.timer.startTime.getTime(),n.getTime());m=Date.now()-d}let g=l+m;if(this.renderDateNav(i,t,e,g),this.renderProgressBar(i,g,t),this.timer.status==="idle"){let d=i.createDiv("today-breakdown");if(r.length===0)d.createDiv("today-empty").setText("No sessions");else{let v=[...r].sort((T,p)=>new Date(T.session.start).getTime()-new Date(p.session.start).getTime());for(let{index:T,session:p}of v)this.renderSessionRow(d,T,p,n,a)}}}renderDateNav(s,t,e,i){let n=s.createDiv("session-nav"),a=n.createEl("button",{cls:"session-nav-btn"});(0,M.setIcon)(a,"chevron-left"),a.onClickEvent(()=>{t.setDate(t.getDate()-1),this.timer.trigger("change")}),n.createSpan("session-nav-label").setText(this.getDateLabel(t,e)),n.createSpan("session-nav-total").setText(S(i));let r=n.createEl("button",{cls:"session-nav-btn"});(0,M.setIcon)(r,"chevron-right"),e&&(r.disabled=!0,r.addClass("disabled")),r.onClickEvent(()=>{e||(t.setDate(t.getDate()+1),this.timer.trigger("change"))})}renderProgressBar(s,t,e){let i=this.plugin.settings.dailyGoalMins[e.getDay()]*6e4,n=Math.min(t/i,1),r=s.createDiv("today-progress").createDiv("today-progress-fill");r.style.width=`${n*100}%`}renderSessionRow(s,t,e,i,n){var u,D;let a=this.store.getProject(e.project),r=new Date(e.start),o=new Date(e.end),l=r<i?i:r,m=o>n?n:o,g=m.getTime()-l.getTime(),d=s.createDiv("session-row"),v=d.createSpan("today-dot");v.style.backgroundColor=(u=a==null?void 0:a.color)!=null?u:"#888";let T=d.createDiv("session-content"),p=T.createDiv("session-top-row");p.createSpan("today-name").setText((D=a==null?void 0:a.name)!=null?D:e.project),p.createSpan("today-time").setText(S(g)),T.createSpan("session-time-range").setText(`${V(l)} \u2013 ${V(m)}`);let h=d.createDiv("session-delete");(0,M.setIcon)(h,"x"),h.onClickEvent(async y=>{y.stopPropagation();let b={...e};await this.store.deleteSession(t),this.timer.trigger("change");let E=new M.Notice("Session deleted",5e3);E.noticeEl.createEl("a",{text:"Undo",cls:"session-undo"}).onClickEvent(async()=>{await this.store.addSession(b),this.timer.trigger("change"),E.hide()})}),d.onClickEvent(()=>{new w(this.app,this.timer,this.store,{editIndex:t,session:e}).open()})}getDateLabel(s,t){if(t)return"Today";let e=new Date;e.setHours(0,0,0,0);let i=new Date(s);return i.setHours(0,0,0,0),Math.round((e.getTime()-i.getTime())/864e5)===1?"Yesterday":i.toLocaleDateString(void 0,{month:"short",day:"numeric"})}};var W=class{constructor(s){this.store=s}render(s,t,e){let i=s.createDiv("analytics-view");this.renderChart(i,t,e),this.renderStats(i,t),this.renderProjectSummary(i,t)}renderChart(s,t,e){let i=s.createDiv("analytics-section"),{start:n,end:a}=this.getPeriodRange(t),r=this.getSessions(t),o=this.store.getTotalTimeInRange(r,n,a),l=i.createDiv("analytics-header"),m=l.createDiv("analytics-toggle"),g=m.createEl("button",{cls:"toggle-btn",text:"W"});t==="week"&&g.addClass("active"),g.onClickEvent(()=>e("week"));let d=m.createEl("button",{cls:"toggle-btn",text:"M"});t==="month"&&d.addClass("active"),d.onClickEvent(()=>e("month")),l.createSpan("analytics-total").setText(S(o));let v=t==="week"?this.getWeekDailyData():this.getMonthDailyData(),T=Math.max(...v.map(h=>h.total),1),p=i.createDiv("week-chart");t==="month"&&p.addClass("week-chart--month");for(let h of v){let u=p.createDiv("week-col"),D=u.createDiv("week-bar");D.dataset.tooltip=S(h.total);let y=D.createDiv("week-bar-stack"),b=h.total/T*100;if(y.style.height=`${Math.max(b,h.total>0?4:2)}%`,h.total>0)for(let I of h.projects){let P=y.createDiv("stack-segment");P.style.height=`${I.time/h.total*100}%`,P.style.backgroundColor=I.color}let E=u.createDiv("week-label");h.isToday&&E.addClass("today"),E.setText(h.label)}}renderStats(s,t){let e=s.createDiv("analytics-section stats-section"),{start:i,end:n}=this.getPeriodRange(t),a=this.getSessions(t),r=this.store.getTotalTimeInRange(a,i,n),o=new Date,l=t==="week"?(o.getDay()+6)%7+1:o.getDate(),m=r/l,d=e.createDiv("stats-grid").createDiv("stat-item");d.createDiv("stat-value").setText(S(m)),d.createDiv("stat-label").setText("Daily Avg")}renderProjectSummary(s,t){var d,v,T;let e=s.createDiv("analytics-section");e.createDiv("analytics-header").createSpan("analytics-label").setText("By Project");let{start:n,end:a}=this.getPeriodRange(t),r=this.getSessions(t),o=this.store.getTotalTimeInRange(r,n,a);if(r.length===0){e.createDiv("analytics-empty").setText("No data");return}let l=j(r),m=e.createDiv("project-breakdown"),g=Object.entries(l).map(([p,h])=>({id:p,time:this.store.getTotalTimeInRange(h,n,a)})).sort((p,h)=>h.time-p.time);for(let{id:p,time:h}of g){let u=this.store.getProject(p),D=o>0?h/o*100:0,y=m.createDiv("breakdown-row"),b=y.createDiv("breakdown-info"),E=b.createSpan("breakdown-dot");E.style.backgroundColor=(d=u==null?void 0:u.color)!=null?d:"#888",b.createSpan("breakdown-name").setText((v=u==null?void 0:u.name)!=null?v:p),b.createSpan("breakdown-time").setText(S(h));let P=y.createDiv("breakdown-bar").createDiv("breakdown-bar-fill");P.style.width=`${D}%`,P.style.backgroundColor=(T=u==null?void 0:u.color)!=null?T:"#888"}}getSessions(s){return s==="week"?this.store.getWeekSessions():this.store.getMonthSessions()}getPeriodRange(s){let t=new Date;if(s==="week"){let n=(t.getDay()+6)%7,a=new Date(t);a.setDate(t.getDate()-n),a.setHours(0,0,0,0);let r=new Date(a);return r.setDate(r.getDate()+7),{start:a,end:r}}let e=new Date(t.getFullYear(),t.getMonth(),1),i=new Date(t.getFullYear(),t.getMonth()+1,1);return{start:e,end:i}}getWeekDailyData(){let s=new Date,t=(s.getDay()+6)%7,e=["M","T","W","T","F","S","S"],i=[];for(let n=0;n<7;n++){let a=new Date(s);a.setDate(s.getDate()-t+n),a.setHours(0,0,0,0);let r=new Date(a);r.setDate(a.getDate()+1);let o=this.store.getSessionsInRange(a,r),l=this.store.getTotalTimeInRange(o,a,r),m=this.getProjectBreakdown(o,a,r);i.push({label:e[n],total:l,isToday:n===t,projects:m})}return i}getMonthDailyData(){let s=new Date,t=new Date(s.getFullYear(),s.getMonth()+1,0).getDate(),e=[];for(let i=1;i<=t;i++){let n=new Date(s.getFullYear(),s.getMonth(),i),a=new Date(s.getFullYear(),s.getMonth(),i+1),r=this.store.getSessionsInRange(n,a),o=this.store.getTotalTimeInRange(r,n,a),l=this.getProjectBreakdown(r,n,a);e.push({label:i.toString(),total:o,isToday:i===s.getDate(),projects:l})}return e}getProjectBreakdown(s,t,e){let i=j(s);return Object.entries(i).map(([n,a])=>{var r,o;return{color:(o=(r=this.store.getProject(n))==null?void 0:r.color)!=null?o:"#888",time:this.store.getTotalTimeInRange(a,t,e)}}).sort((n,a)=>a.time-n.time)}};var k="time-tracker-sidebar",F=class extends X.ItemView{constructor(t,e,i,n){super(t);this.interval=null;this.activeTab="timer";this.analyticsMode="week";this.viewDate=new Date;this.timer=e,this.store=i,this.plugin=n,this.timerSection=new B(this.app,e,i),this.sessionsSection=new O(this.app,e,i,n),this.analyticsSection=new W(i)}getViewType(){return k}getDisplayText(){return"Time Tracker"}getIcon(){return"clock"}async onOpen(){this.timer.on("change",()=>this.render()),this.interval=window.setInterval(()=>{this.timer.status==="running"&&this.render()},1e3),this.render()}async onClose(){this.interval&&window.clearInterval(this.interval)}render(){let t=this.containerEl.children[1];if(t.empty(),t.addClass("time-tracker-sidebar"),this.renderTabs(t),this.activeTab==="timer"){let e=t.createDiv("timer-view");this.timerSection.render(e,this.viewDate),this.sessionsSection.render(e,this.viewDate,this.isViewingToday())}else this.analyticsSection.render(t,this.analyticsMode,e=>{this.analyticsMode=e,this.render()})}renderTabs(t){let e=t.createDiv("sidebar-tabs"),i=e.createDiv("sidebar-tab");i.setText("Timer"),this.activeTab==="timer"&&i.addClass("active"),i.onClickEvent(()=>{this.activeTab="timer",this.render()});let n=e.createDiv("sidebar-tab");n.setText("Analytics"),this.activeTab==="analytics"&&n.addClass("active"),n.onClickEvent(()=>{this.activeTab="analytics",this.render()})}isViewingToday(){let t=new Date;return this.viewDate.getFullYear()===t.getFullYear()&&this.viewDate.getMonth()===t.getMonth()&&this.viewDate.getDate()===t.getDate()}};var N=class extends Z.Plugin{async onload(){await this.loadSettings(),this.store=new A(this),await this.store.load(),this.timer=new L(this.store,t=>this.saveTimerState(t)),this.timer.load(this.settings.timerState),this.registerView(k,t=>new F(t,this.timer,this.store,this)),this.statusBar=new H(this,this.timer,this.store),this.timer.on("status-bar-click",()=>this.activateSidebar()),this.addCommand({id:"open-tracker",name:"Open Time Tracker",callback:()=>this.activateSidebar()}),this.addCommand({id:"start-stop",name:"Start/Stop Timer",callback:async()=>{this.timer.status==="running"?await this.timer.stop():await this.activateSidebar()}}),this.addCommand({id:"show-stats",name:"Show Stats",callback:()=>new R(this.app,this.store).open()}),this.addCommand({id:"add-manual",name:"Add Time Manually",callback:()=>new w(this.app,this.timer,this.store).open()}),this.addSettingTab(new $(this.app,this)),this.app.workspace.onLayoutReady(()=>this.initSidebar())}onunload(){var t;(t=this.statusBar)==null||t.destroy(),this.app.workspace.detachLeavesOfType(k)}async activateSidebar(){let{workspace:t}=this.app,e=t.getLeavesOfType(k)[0];if(!e){let i=t.getRightLeaf(!1);i&&(e=i,await e.setViewState({type:k,active:!0}))}e&&t.revealLeaf(e)}async initSidebar(){this.app.workspace.getLeavesOfType(k).length===0&&await this.activateSidebar()}async loadSettings(){if(this.settings=Object.assign({},Y,await this.loadData()),!Array.isArray(this.settings.dailyGoalMins)){let t=this.settings.dailyGoalMins;this.settings.dailyGoalMins=Array(7).fill(t)}}async saveSettings(){await this.saveData(this.settings)}async saveTimerState(t){this.settings.timerState=t,await this.saveSettings()}};
