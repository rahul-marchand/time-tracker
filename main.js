"use strict";var $=Object.defineProperty;var _=Object.getOwnPropertyDescriptor;var F=Object.getOwnPropertyNames;var U=Object.prototype.hasOwnProperty;var J=(m,r)=>{for(var t in r)$(m,t,{get:r[t],enumerable:!0})},G=(m,r,t,e)=>{if(r&&typeof r=="object"||typeof r=="function")for(let s of F(r))!U.call(m,s)&&s!==t&&$(m,s,{get:()=>r[s],enumerable:!(e=_(r,s))||e.enumerable});return m};var Y=m=>G($({},"__esModule",{value:!0}),m);var q={};J(q,{default:()=>L});module.exports=Y(q);var N=require("obsidian");var A={timerState:{status:"idle",projectId:null,startTime:null}},B=[{id:"work",name:"Work",color:"#5f8eed",icon:"briefcase"},{id:"personal",name:"Personal",color:"#50c878",icon:"home"}],H=["briefcase","home","book","code","coffee","heart","star","folder","file-text","music","camera","globe","zap","sun","moon","cloud","pen-tool","cpu","database","terminal","graduation-cap","dumbbell","bike","car","plane","shopping-cart","dollar-sign","clock","calendar","mail","phone","map-pin","users","user","settings","wrench"];var z="time-data.json",P=class{constructor(r){this.data={projects:[],sessions:[]};this.plugin=r}get path(){return`${this.plugin.manifest.dir}/${z}`}async load(){let{adapter:r}=this.plugin.app.vault;await r.exists(this.path)?this.data=JSON.parse(await r.read(this.path)):(this.data={projects:[...B],sessions:[]},await this.save())}async save(){await this.plugin.app.vault.adapter.write(this.path,JSON.stringify(this.data,null,"	"))}get projects(){return this.data.projects}getProject(r){return this.data.projects.find(t=>t.id===r)}async addProject(r){this.data.projects.push(r),await this.save()}async updateProject(r,t){let e=this.getProject(r);e&&(Object.assign(e,t),await this.save())}async deleteProject(r){this.data.projects=this.data.projects.filter(t=>t.id!==r),this.data.sessions=this.data.sessions.filter(t=>t.project!==r),await this.save()}get sessions(){return this.data.sessions}async addSession(r){this.data.sessions.push(r),await this.save()}async updateSession(r,t){r>=0&&r<this.data.sessions.length&&(this.data.sessions[r]=t,await this.save())}async deleteSession(r){r>=0&&r<this.data.sessions.length&&(this.data.sessions.splice(r,1),await this.save())}getSessionsInRange(r,t){return this.data.sessions.filter(e=>{let s=new Date(e.start).getTime();return s>=r.getTime()&&s<t.getTime()})}getTotalTime(r){return r.reduce((t,e)=>t+new Date(e.end).getTime()-new Date(e.start).getTime(),0)}getTodaySessions(){let r=new Date;r.setHours(0,0,0,0);let t=new Date(r);return t.setDate(t.getDate()+1),this.getSessionsInRange(r,t)}getWeekSessions(){let r=new Date,t=new Date(r);t.setDate(r.getDate()-r.getDay()),t.setHours(0,0,0,0);let e=new Date(t);return e.setDate(e.getDate()+7),this.getSessionsInRange(t,e)}};var V=require("obsidian"),k=class extends V.Events{constructor(t,e){super();this.state={status:"idle",projectId:null,startTime:null};this.store=t,this.persistState=e}load(t){this.state=t}get status(){return this.state.status}get projectId(){return this.state.projectId}get startTime(){return this.state.startTime?new Date(this.state.startTime):null}get elapsed(){return this.state.status==="idle"||!this.state.startTime?0:Date.now()-new Date(this.state.startTime).getTime()}async start(t){this.state.status==="running"&&await this.stop(),this.state={status:"running",projectId:t,startTime:new Date().toISOString()},await this.persistState(this.state),this.trigger("change")}async stop(){if(this.state.status==="idle"||!this.state.projectId||!this.state.startTime)return null;let t={project:this.state.projectId,start:this.state.startTime,end:new Date().toISOString()};return await this.store.addSession(t),this.state={status:"idle",projectId:null,startTime:null},await this.persistState(this.state),this.trigger("change"),t}async discard(){this.state={status:"idle",projectId:null,startTime:null},await this.persistState(this.state),this.trigger("change")}async addManual(t,e,s){await this.store.addSession({project:t,start:e.toISOString(),end:s.toISOString()}),this.trigger("change")}};var E=class{constructor(r,t,e){this.interval=null;this.timer=t,this.store=e,this.el=r.addStatusBarItem(),this.el.addClass("time-tracker-status"),this.el.onClickEvent(()=>this.onClick()),this.timer.on("change",()=>this.render()),this.render(),this.startInterval()}startInterval(){this.interval=window.setInterval(()=>{this.timer.status==="running"&&this.render()},1e3)}destroy(){this.interval&&window.clearInterval(this.interval)}render(){var e;let{status:r,projectId:t}=this.timer;if(r==="idle")this.el.setText("\u23F1 No timer"),this.el.removeClass("is-running");else{let s=this.store.getProject(t),a=(e=s==null?void 0:s.name)!=null?e:t,i=this.formatTime(this.timer.elapsed);this.el.setText(`\u23F1 ${a} ${i}`),this.el.addClass("is-running")}}formatTime(r){let t=Math.floor(r/1e3),e=Math.floor(t/3600),s=Math.floor(t%3600/60),a=t%60;return`${e.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`}onClick(){this.timer.trigger("status-bar-click")}};var W=require("obsidian"),C=class extends W.Modal{constructor(t,e){super(t);this.store=e}onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("time-tracker-stats-modal"),t.createEl("h2",{text:"Time Stats"}),this.renderSection(t,"Today",this.store.getTodaySessions()),this.renderSection(t,"This Week",this.store.getWeekSessions())}renderSection(t,e,s){var h,p;let a=t.createDiv("stats-section");a.createEl("h3",{text:e});let i=this.groupByProject(s),o=this.store.getTotalTime(s);if(Object.keys(i).length===0){a.createEl("p",{text:"No time tracked",cls:"muted"});return}let l=a.createEl("ul",{cls:"stats-list"});for(let[d,g]of Object.entries(i)){let n=this.store.getProject(d),u=this.store.getTotalTime(g),c=l.createEl("li"),b=c.createSpan({cls:"color-dot"});b.style.backgroundColor=(h=n==null?void 0:n.color)!=null?h:"#888",c.createSpan({text:`${(p=n==null?void 0:n.name)!=null?p:d}: ${this.formatTime(u)}`})}a.createEl("p",{text:`Total: ${this.formatTime(o)}`,cls:"stats-total"})}groupByProject(t){var s,a;let e={};for(let i of t)((a=e[s=i.project])!=null?a:e[s]=[]).push(i);return e}formatTime(t){let e=Math.round(t/6e4),s=Math.floor(e/60),a=e%60;return s>0?`${s}h ${a}m`:`${a}m`}onClose(){this.contentEl.empty()}};var v=require("obsidian"),I=class extends v.Modal{constructor(t,e,s){var i,o;super(t);this.timer=e,this.store=s;let a=new Date;this.projectId=(o=(i=this.store.projects[0])==null?void 0:i.id)!=null?o:"",this.date=a.toISOString().split("T")[0],this.startTime="09:00",this.endTime="10:00"}onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("time-tracker-manual-modal"),t.createEl("h3",{text:"Add Time Manually"}),new v.Setting(t).setName("Project").addDropdown(e=>{for(let s of this.store.projects)e.addOption(s.id,s.name);e.setValue(this.projectId),e.onChange(s=>this.projectId=s)}),new v.Setting(t).setName("Date").addText(e=>{e.inputEl.type="date",e.setValue(this.date),e.onChange(s=>this.date=s)}),new v.Setting(t).setName("Start Time").addText(e=>{e.inputEl.type="time",e.setValue(this.startTime),e.onChange(s=>this.startTime=s)}),new v.Setting(t).setName("End Time").addText(e=>{e.inputEl.type="time",e.setValue(this.endTime),e.onChange(s=>this.endTime=s)}),new v.Setting(t).addButton(e=>{e.setButtonText("Add"),e.setCta(),e.onClick(()=>this.submit())})}async submit(){let t=new Date(`${this.date}T${this.startTime}`),e=new Date(`${this.date}T${this.endTime}`);e<=t||(await this.timer.addManual(this.projectId,t,e),this.close())}onClose(){this.contentEl.empty()}};var S=require("obsidian");var x=class extends S.PluginSettingTab{constructor(t,e){super(t,e);this.plugin=e}display(){let{containerEl:t}=this;t.empty(),t.createEl("h2",{text:"Projects"});for(let e of this.plugin.store.projects)this.renderProject(t,e);new S.Setting(t).addButton(e=>{e.setButtonText("Add Project"),e.setCta(),e.onClick(async()=>{let s=`project-${Date.now()}`;await this.plugin.store.addProject({id:s,name:"New Project",color:this.randomColor(),icon:"folder"}),this.display()})})}renderProject(t,e){let s=new S.Setting(t);s.setName(e.name);let a=s.nameEl.createSpan({cls:"project-icon"});(0,S.setIcon)(a,e.icon||"folder"),s.nameEl.prepend(a),s.addDropdown(i=>{for(let o of H)i.addOption(o,o);i.setValue(e.icon||"folder"),i.onChange(async o=>{await this.plugin.store.updateProject(e.id,{icon:o}),a.empty(),(0,S.setIcon)(a,o)})}),s.addText(i=>{i.setValue(e.name),i.onChange(async o=>{await this.plugin.store.updateProject(e.id,{name:o}),s.setName(o)})}),s.addText(i=>{i.inputEl.type="color",i.inputEl.addClass("color-input"),i.setValue(e.color),i.onChange(async o=>{await this.plugin.store.updateProject(e.id,{color:o})})}),this.plugin.store.projects.length>1&&s.addButton(i=>{i.setIcon("trash"),i.setWarning(),i.onClick(async()=>{await this.plugin.store.deleteProject(e.id),this.display()})})}randomColor(){return`hsl(${Math.floor(Math.random()*360)}, 60%, 50%)`}};var w=require("obsidian"),f="time-tracker-sidebar",M=class extends w.ItemView{constructor(t,e,s){super(t);this.interval=null;this.activeTab="timer";this.timer=e,this.store=s}getViewType(){return f}getDisplayText(){return"Time Tracker"}getIcon(){return"clock"}async onOpen(){this.timer.on("change",()=>this.render()),this.startInterval(),this.render()}async onClose(){this.interval&&window.clearInterval(this.interval)}startInterval(){this.interval=window.setInterval(()=>{this.timer.status==="running"&&this.render()},1e3)}render(){let t=this.containerEl.children[1];t.empty(),t.addClass("time-tracker-sidebar"),this.renderTabs(t),this.activeTab==="timer"?this.renderTimerView(t):this.renderAnalyticsView(t)}renderTabs(t){let e=t.createDiv("sidebar-tabs"),s=e.createDiv("sidebar-tab");s.setText("Timer"),this.activeTab==="timer"&&s.addClass("active"),s.onClickEvent(()=>{this.activeTab="timer",this.render()});let a=e.createDiv("sidebar-tab");a.setText("Analytics"),this.activeTab==="analytics"&&a.addClass("active"),a.onClickEvent(()=>{this.activeTab="analytics",this.render()})}renderTimerView(t){let e=t.createDiv("timer-view");this.renderTimer(e),this.renderToday(e)}renderTimer(t){var s,a;let e=t.createDiv("timer-section");if(this.timer.status==="idle"){let i=e.createDiv("project-buttons");for(let o of this.store.projects){let l=i.createEl("button",{cls:"project-btn"});l.style.setProperty("--project-color",o.color),l.style.setProperty("--icon-color",this.getContrastColor(o.color));let h=l.createDiv("project-btn-icon");(0,w.setIcon)(h,o.icon||"play"),l.createDiv("project-btn-content").createSpan("project-btn-name").setText(o.name),l.onClickEvent(()=>this.timer.start(o.id))}}else{let i=this.store.getProject(this.timer.projectId);e.addClass("running"),e.style.setProperty("--active-color",(s=i==null?void 0:i.color)!=null?s:"#888");let o=e.createDiv("timer-active-header");o.createSpan("timer-active-label").setText("Tracking"),o.createSpan("timer-active-project").setText((a=i==null?void 0:i.name)!=null?a:"Unknown"),e.createDiv("timer-display").setText(this.formatTime(this.timer.elapsed));let h=e.createDiv("timer-actions"),p=h.createEl("button",{cls:"timer-btn stop"});p.createSpan("timer-btn-icon").setText("\u25A0"),p.createSpan().setText("Stop"),p.onClickEvent(()=>this.timer.stop());let d=h.createEl("button",{cls:"timer-btn switch"});d.createSpan("timer-btn-icon").setText("\u21BB"),d.createSpan().setText("Switch"),d.onClickEvent(g=>this.showSwitchMenu(d,g))}}renderToday(t){var n,u;let e=t.createDiv("today-section"),s=this.store.getTodaySessions(),a=this.store.getTotalTime(s),i=this.timer.status==="running"?this.timer.elapsed:0,o=a+i,l=e.createDiv("today-header");l.createSpan("today-label").setText("Today"),l.createSpan("today-total").setText(this.formatTimeHM(o));let h=8*60*60*1e3,p=Math.min(o/h,1),g=e.createDiv("today-progress").createDiv("today-progress-fill");if(g.style.width=`${p*100}%`,this.timer.status==="idle"){let c=e.createDiv("today-breakdown");if(s.length===0)c.createDiv("today-empty").setText("No sessions yet today");else{let b=this.groupByProject(s);for(let[D,j]of Object.entries(b)){let T=this.store.getProject(D),O=this.store.getTotalTime(j),y=c.createDiv("today-row"),R=y.createSpan("today-dot");R.style.backgroundColor=(n=T==null?void 0:T.color)!=null?n:"#888",y.createSpan("today-name").setText((u=T==null?void 0:T.name)!=null?u:D),y.createSpan("today-time").setText(this.formatTimeHM(O))}}}}renderAnalyticsView(t){let e=t.createDiv("analytics-view");this.renderWeekChart(e),this.renderProjectBreakdown(e)}renderWeekChart(t){let e=t.createDiv("analytics-section"),s=this.store.getWeekSessions(),a=this.store.getTotalTime(s),i=e.createDiv("analytics-header");i.createSpan("analytics-label").setText("This Week"),i.createSpan("analytics-total").setText(this.formatTimeHM(a));let o=this.getDailyTotals(),l=Math.max(...o.map(d=>d.total),1),h=e.createDiv("week-chart"),p=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];o.forEach((d,g)=>{let n=h.createDiv("week-bar"),u=d.total/l*100,c=n.createDiv("week-bar-fill");c.style.height=`${Math.max(u,2)}%`,d.isToday&&c.addClass("today"),n.createDiv("week-bar-label").setText(p[g])})}renderProjectBreakdown(t){var p,d,g;let e=t.createDiv("analytics-section");e.createDiv("analytics-header").createSpan("analytics-label").setText("By Project");let a=this.store.getWeekSessions(),i=this.store.getTotalTime(a);if(a.length===0){e.createDiv("analytics-empty").setText("No data this week");return}let o=this.groupByProject(a),l=e.createDiv("project-breakdown"),h=Object.entries(o).map(([n,u])=>({id:n,time:this.store.getTotalTime(u)})).sort((n,u)=>u.time-n.time);for(let{id:n,time:u}of h){let c=this.store.getProject(n),b=i>0?u/i*100:0,D=l.createDiv("breakdown-row"),j=D.createDiv("breakdown-info"),T=j.createSpan("breakdown-dot");T.style.backgroundColor=(p=c==null?void 0:c.color)!=null?p:"#888",j.createSpan("breakdown-name").setText((d=c==null?void 0:c.name)!=null?d:n),j.createSpan("breakdown-time").setText(this.formatTimeHM(u));let y=D.createDiv("breakdown-bar").createDiv("breakdown-bar-fill");y.style.width=`${b}%`,y.style.backgroundColor=(g=c==null?void 0:c.color)!=null?g:"#888"}}getDailyTotals(){let t=new Date,e=(t.getDay()+6)%7,s=[];for(let a=0;a<7;a++){let i=new Date(t);i.setDate(t.getDate()-e+a),i.setHours(0,0,0,0);let o=new Date(i);o.setDate(i.getDate()+1);let l=this.store.getSessionsInRange(i,o),h=this.store.getTotalTime(l);s.push({total:h,isToday:a===e})}return s}showSwitchMenu(t,e){let s=new w.Menu;for(let a of this.store.projects)a.id!==this.timer.projectId&&s.addItem(i=>{i.setTitle(a.name),i.onClick(()=>this.timer.start(a.id))});s.showAtMouseEvent(e)}groupByProject(t){var s,a;let e={};for(let i of t)((a=e[s=i.project])!=null?a:e[s]=[]).push(i);return e}formatTime(t){let e=Math.floor(t/1e3),s=Math.floor(e/3600),a=Math.floor(e%3600/60),i=e%60;return`${s.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}`}formatTimeHM(t){let e=Math.round(t/6e4),s=Math.floor(e/60),a=e%60;return s>0?`${s}h ${a}m`:`${a}m`}getContrastColor(t){let e=parseInt(t.slice(1,3),16),s=parseInt(t.slice(3,5),16),a=parseInt(t.slice(5,7),16);return(.299*e+.587*s+.114*a)/255>.5?"#2e2e2e":"#ffffff"}};var L=class extends N.Plugin{async onload(){await this.loadSettings(),this.store=new P(this),await this.store.load(),this.timer=new k(this.store,t=>this.saveTimerState(t)),this.timer.load(this.settings.timerState),this.registerView(f,t=>new M(t,this.timer,this.store)),this.statusBar=new E(this,this.timer,this.store),this.timer.on("status-bar-click",()=>this.activateSidebar()),this.addCommand({id:"open-tracker",name:"Open Time Tracker",callback:()=>this.activateSidebar()}),this.addCommand({id:"start-stop",name:"Start/Stop Timer",callback:()=>{this.timer.status==="running"?this.timer.stop():this.activateSidebar()}}),this.addCommand({id:"show-stats",name:"Show Stats",callback:()=>new C(this.app,this.store).open()}),this.addCommand({id:"add-manual",name:"Add Time Manually",callback:()=>new I(this.app,this.timer,this.store).open()}),this.addSettingTab(new x(this.app,this)),this.app.workspace.onLayoutReady(()=>this.initSidebar())}onunload(){var t;(t=this.statusBar)==null||t.destroy(),this.app.workspace.detachLeavesOfType(f)}async activateSidebar(){let{workspace:t}=this.app,e=t.getLeavesOfType(f)[0];if(!e){let s=t.getRightLeaf(!1);s&&(e=s,await e.setViewState({type:f,active:!0}))}e&&t.revealLeaf(e)}async initSidebar(){this.app.workspace.getLeavesOfType(f).length===0&&await this.activateSidebar()}async loadSettings(){this.settings=Object.assign({},A,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}async saveTimerState(t){this.settings.timerState=t,await this.saveSettings()}};
